人工触发：在对话或提交描述中出现以下关键词时，按流程执行
记录变更、更新 PLAYBOOKS、保存记忆、按照 PLAYBOOKS 流程完成、记忆和文档都更新了吗？、PLAYBOOKS
同义词：记录决策、记录配置变更、记录改进、记录经验教训、记录性能基准

自动记忆（PLAYBOOKS 三步）
触发条件：你的消息中出现关键词（记录变更/更新 PLAYBOOKS/保存记忆/按照 PLAYBOOKS 流程完成/记忆和文档都更新了吗？/PLAYBOOKS 等）
自动动作：
更新 PLAYBOOKS 文档条目
保存关键决策到记忆系统
同步 docs/ 文档索引与“最近变更（自动生成）”
保障机制：memory_index 仅在内容变化时写入，避免无差异改写；中文兼容已增强
自动代码质量检查（严格策略，默认开启）
触发条件：我进行或建议任何代码/配置修改后，以及你发出“确保全绿/跑钩子/跑检查”等指令
自动动作（本地安全执行）：
运行 pre-commit run --all-files（ruff/black/mypy/bandit/mdformat/yaml 等）
如有 mdformat/black 自动格式化，直接纳入本次提交
仅当需要安装新依赖、迁移数据库、长任务等风险动作时，才会先征求你同意
远端保障：CI 已新增“pre-commit 全绿检查 Job”，所有 PR 先过此 Job，报告作为工件上传；build-test 依赖其结果

记忆相关
“更新 PLAYBOOKS：xxx” 或 “记录变更：xxx” → 自动执行三步（文档、记忆、索引）
“记忆和文档都更新了吗？” → 自动检查并补齐
质量检查相关
“确保全绿/跑钩子/跑检查/本地跑一遍” → 我会运行 pre-commit 并汇报摘要和关键日志
“CI 跑一遍并给我报告” → 我会触发推送/PR 并在 CI 完成后返回工件链接（需要你确认 push/PR）

当你发出：记录变更/更新 PLAYBOOKS/保存记忆/按照 PLAYBOOKS 流程完成/记忆和文档都更新了吗？/PLAYBOOKS
我会自动：更新 PLAYBOOKS → 保存关键记忆 → 同步“最近变更”和 INDEX（仅在内容变化时写入）

新会话启动模板（直接粘贴使用）
请按项目规则与文档体系执行：
遵循 PROJECT_RULES.md 与 docs/（SCHEMA_AND_DB.md、DATA_SPEC.md、ALIGNMENT_POLICY.md、PERFORMANCE_OPTIMIZATION.md、DECISIONS.md、LESSONS_LEARNED.md、CONFIGURATION_CHANGES.md 等）
不读取 venv/ 和 data/ 目录
启动前动作：
加载并对齐 PLAYBOOKS 历史：扫描 docs/PLAYBOOKS 下记录，汇总与本任务相关的“决策/经验/优化/配置变更/基准”
给出本任务的风险点清单与应对策略（直接引用相关文档条款）
代码改动约定（必须执行）：
每次改动后：先本地 pre-commit 全量体检（ruff、black、mypy、bandit、mdformat、check-yaml、mixed-line-ending、memory-check、memory-index）
自动执行 PLAYBOOKS 三步（仅在内容变化时写入）：更新记录 → 保存记忆 → 同步“最近变更”和 INDEX
修复后再次运行 pre-commit 确保全绿
CI 约定：
持续保持 pre-commit Job 全绿；PR 下方自动贴出详细 pre-commit 报告（已配置），Actions Summary 显示摘要
授权范围（默认同意）：
允许运行本地只读/安全命令：pre-commit、ruff/black/mypy/bandit、mdformat、pytest -q（不执行迁移、部署、数据写入）
如需安装依赖、改数据库、长任务，会先征求确认
输出要求：
每一步给出“执行了什么/结果如何/下一步”的简明小结
引用文档时点明来源文件与条目标题（便于溯源）

进行具体开发任务时的简短模板
任务目标：一句话说明要改什么
必须遵循的文档点：列 2-3 条（比如字段命名/性能要求/对齐策略）
安全边界：是否允许安装依赖/执行长任务
验收标准：通过哪些钩子/测试/指标
示例

任务目标：为 fact_measurements 增加写入幂等接口
文档约束：对齐规则参考 ALIGNMENT_POLICY.md；CRUD 优化参考 SCHEMA_AND_DB.md/CRUD 章节
安全边界：不改数据库结构，仅改应用层
验收标准：pre-commit 全绿 + 新增单测通过
