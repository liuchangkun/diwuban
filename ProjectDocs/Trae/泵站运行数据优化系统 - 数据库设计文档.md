# 泵站运行数据优化系统 - 数据库设计文档

## 🔧 如何使用本规范
- 建模流程：需求→实体→关系→指标→约束→索引→分区→审计→变更脚本
- 审核清单：主外键、唯一约束、时间精度、字符集、索引覆盖、软删除/审计字段
- 性能：热点字段索引、写多读少表的批量写策略、历史表/归档策略
- 变更：所有DDL通过脚本执行，带回滚；生成变更说明

---

## 1. 数据库概述

### 1.1 基本信息
- **数据库类型**: MySQL 8.0.12
- **字符集**: utf8mb4
- **排序规则**: utf8mb4_unicode_ci
- **时区**: UTC
- **数据库名称**: `pump_station_optimization`

### 1.2 设计原则
- **数据一致性**: 严格的外键约束和事务控制
- **性能优化**: 合理的索引设计和分区策略
- **扩展性**: 支持水平和垂直扩展
- **数据完整性**: 完善的约束条件和触发器
- **时间精度**: 毫秒级时间戳存储

### 1.3 命名规范
- **表名**: 小写字母，下划线分隔，复数形式
- **字段名**: 小写字母，下划线分隔
- **索引名**: `idx_表名_字段名` 或 `uk_表名_字段名`（唯一索引）
- **外键名**: `fk_表名_引用表名_字段名`

## 2. 核心表结构设计

### 2.1 泵站信息表 (stations)

```sql
CREATE TABLE stations (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '泵站ID',
    station_name VARCHAR(100) NOT NULL COMMENT '泵站名称',
    station_code VARCHAR(50) NOT NULL COMMENT '泵站编码',
    station_type ENUM('supply', 'intake') NOT NULL COMMENT '泵站类型：供水/取水',
    phase ENUM('phase1', 'phase2', 'phase3') NOT NULL COMMENT '期数',
    location VARCHAR(200) DEFAULT NULL COMMENT '位置描述',
    capacity DECIMAL(10,2) DEFAULT NULL COMMENT '设计容量(m³/h)',
    longitude DECIMAL(10,7) DEFAULT NULL COMMENT '经度',
    latitude DECIMAL(10,7) DEFAULT NULL COMMENT '纬度',
    status ENUM('active', 'inactive', 'maintenance') NOT NULL DEFAULT 'active' COMMENT '状态',
    description TEXT DEFAULT NULL COMMENT '描述信息',
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
    created_by VARCHAR(50) DEFAULT NULL COMMENT '创建人',
    updated_by VARCHAR(50) DEFAULT NULL COMMENT '更新人',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_stations_code (station_code),
    UNIQUE KEY uk_stations_name (station_name),
    INDEX idx_stations_type_phase (station_type, phase),
    INDEX idx_stations_status (status),
    INDEX idx_stations_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='泵站信息表';
```

### 2.2 设备信息表 (devices)

```sql
CREATE TABLE devices (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '设备ID',
    station_id BIGINT UNSIGNED NOT NULL COMMENT '所属泵站ID',
    device_name VARCHAR(100) NOT NULL COMMENT '设备名称',
    device_code VARCHAR(50) NOT NULL COMMENT '设备编码',
    device_type ENUM('pump', 'variable_frequency', 'soft_start') NOT NULL COMMENT '设备类型',
    device_number VARCHAR(20) NOT NULL COMMENT '设备编号（如1#、2#）',
    
    -- 设备技术参数
    rated_power DECIMAL(8,2) DEFAULT NULL COMMENT '额定功率(kW)',
    rated_flow DECIMAL(8,2) DEFAULT NULL COMMENT '额定流量(m³/h)',
    rated_head DECIMAL(8,2) DEFAULT NULL COMMENT '额定扬程(m)',
    rated_speed DECIMAL(8,2) DEFAULT NULL COMMENT '额定转速(rpm)',
    rated_efficiency DECIMAL(5,4) DEFAULT NULL COMMENT '额定效率',
    
    -- 设备基本信息
    manufacturer VARCHAR(100) DEFAULT NULL COMMENT '制造商',
    model VARCHAR(100) DEFAULT NULL COMMENT '型号',
    serial_number VARCHAR(100) DEFAULT NULL COMMENT '序列号',
    install_date DATE DEFAULT NULL COMMENT '安装日期',
    warranty_date DATE DEFAULT NULL COMMENT '保修到期日期',
    
    -- 运行参数范围
    min_frequency DECIMAL(5,2) DEFAULT NULL COMMENT '最小运行频率(Hz)',
    max_frequency DECIMAL(5,2) DEFAULT NULL COMMENT '最大运行频率(Hz)',
    min_flow DECIMAL(8,2) DEFAULT NULL COMMENT '最小流量(m³/h)',
    max_flow DECIMAL(8,2) DEFAULT NULL COMMENT '最大流量(m³/h)',
    
    status ENUM('active', 'inactive', 'maintenance', 'fault') NOT NULL DEFAULT 'active' COMMENT '设备状态',
    description TEXT DEFAULT NULL COMMENT '设备描述',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
    created_by VARCHAR(50) DEFAULT NULL COMMENT '创建人',
    updated_by VARCHAR(50) DEFAULT NULL COMMENT '更新人',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_devices_code (device_code),
    UNIQUE KEY uk_devices_station_number (station_id, device_number),
    INDEX idx_devices_station_id (station_id),
    INDEX idx_devices_type (device_type),
    INDEX idx_devices_status (status),
    INDEX idx_devices_name (device_name),
    
    CONSTRAINT fk_devices_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='设备信息表';
```

### 2.3 运行数据表 (operation_data)

```sql
CREATE TABLE operation_data (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '数据ID',
    station_id BIGINT UNSIGNED NOT NULL COMMENT '泵站ID',
    device_id BIGINT UNSIGNED NOT NULL COMMENT '设备ID',
    tag_name VARCHAR(200) NOT NULL COMMENT '数据标签名称',
    data_time TIMESTAMP(3) NOT NULL COMMENT '数据时间（精确到毫秒）',
    data_value DECIMAL(15,6) NOT NULL COMMENT '数据值',
    parameter_type VARCHAR(50) NOT NULL COMMENT '参数类型',
    unit VARCHAR(20) DEFAULT NULL COMMENT '单位',
    quality_code TINYINT UNSIGNED DEFAULT 192 COMMENT '数据质量代码',
    data_source VARCHAR(50) DEFAULT 'scada' COMMENT '数据来源',
    
    -- 数据处理标记
    is_processed BOOLEAN DEFAULT FALSE COMMENT '是否已处理',
    is_validated BOOLEAN DEFAULT FALSE COMMENT '是否已验证',
    is_filled BOOLEAN DEFAULT FALSE COMMENT '是否为补齐数据',
    confidence_score DECIMAL(3,2) DEFAULT NULL COMMENT '置信度分数(0-1)',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_operation_data_unique (station_id, device_id, tag_name, data_time),
    INDEX idx_operation_data_station_device (station_id, device_id),
    INDEX idx_operation_data_time (data_time),
    INDEX idx_operation_data_parameter (parameter_type),
    INDEX idx_operation_data_tag (tag_name),
    INDEX idx_operation_data_processed (is_processed),
    INDEX idx_operation_data_filled (is_filled),
    
    CONSTRAINT fk_operation_data_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_operation_data_device_id FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='运行数据表'
PARTITION BY RANGE (UNIX_TIMESTAMP(data_time)) (
    PARTITION p202501 VALUES LESS THAN (UNIX_TIMESTAMP('2025-02-01 00:00:00')),
    PARTITION p202502 VALUES LESS THAN (UNIX_TIMESTAMP('2025-03-01 00:00:00')),
    PARTITION p202503 VALUES LESS THAN (UNIX_TIMESTAMP('2025-04-01 00:00:00')),
    PARTITION p202504 VALUES LESS THAN (UNIX_TIMESTAMP('2025-05-01 00:00:00')),
    PARTITION p202505 VALUES LESS THAN (UNIX_TIMESTAMP('2025-06-01 00:00:00')),
    PARTITION p202506 VALUES LESS THAN (UNIX_TIMESTAMP('2025-07-01 00:00:00')),
    PARTITION p202507 VALUES LESS THAN (UNIX_TIMESTAMP('2025-08-01 00:00:00')),
    PARTITION p202508 VALUES LESS THAN (UNIX_TIMESTAMP('2025-09-01 00:00:00')),
    PARTITION p202509 VALUES LESS THAN (UNIX_TIMESTAMP('2025-10-01 00:00:00')),
    PARTITION p202510 VALUES LESS THAN (UNIX_TIMESTAMP('2025-11-01 00:00:00')),
    PARTITION p202511 VALUES LESS THAN (UNIX_TIMESTAMP('2025-12-01 00:00:00')),
    PARTITION p202512 VALUES LESS THAN (UNIX_TIMESTAMP('2026-01-01 00:00:00')),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 2.4 特性曲线拟合结果表 (characteristic_curves)

```sql
CREATE TABLE characteristic_curves (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '曲线ID',
    device_id BIGINT UNSIGNED NOT NULL COMMENT '设备ID',
    curve_type ENUM('head_flow', 'efficiency_flow', 'power_flow', 'npsh_flow') NOT NULL COMMENT '曲线类型',
    fitting_method VARCHAR(50) NOT NULL COMMENT '拟合方法',
    
    -- 拟合参数和结果
    model_parameters JSON NOT NULL COMMENT '模型参数（JSON格式）',
    model_metadata JSON DEFAULT NULL COMMENT '模型元数据',
    
    -- 精度指标
    r_squared DECIMAL(6,5) NOT NULL COMMENT 'R²决定系数',
    rmse DECIMAL(10,6) NOT NULL COMMENT '均方根误差',
    mae DECIMAL(10,6) NOT NULL COMMENT '平均绝对误差',
    mape DECIMAL(6,3) DEFAULT NULL COMMENT '平均绝对百分比误差',
    
    -- 验证指标
    cross_validation_score DECIMAL(6,5) DEFAULT NULL COMMENT '交叉验证分数',
    validation_score DECIMAL(6,5) DEFAULT NULL COMMENT '验证集分数',
    physics_consistency_score DECIMAL(6,5) DEFAULT NULL COMMENT '物理一致性分数',
    
    -- 数据信息
    data_points_count INT UNSIGNED NOT NULL COMMENT '训练数据点数量',
    data_time_range_start TIMESTAMP(3) NOT NULL COMMENT '数据时间范围开始',
    data_time_range_end TIMESTAMP(3) NOT NULL COMMENT '数据时间范围结束',
    
    -- 适用范围
    flow_range_min DECIMAL(8,2) DEFAULT NULL COMMENT '流量范围最小值',
    flow_range_max DECIMAL(8,2) DEFAULT NULL COMMENT '流量范围最大值',
    head_range_min DECIMAL(8,2) DEFAULT NULL COMMENT '扬程范围最小值',
    head_range_max DECIMAL(8,2) DEFAULT NULL COMMENT '扬程范围最大值',
    
    -- 状态和版本
    is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT '是否激活',
    version VARCHAR(20) NOT NULL DEFAULT '1.0' COMMENT '版本号',
    confidence_level ENUM('low', 'medium', 'high') NOT NULL DEFAULT 'medium' COMMENT '置信水平',
    
    fitting_date TIMESTAMP(3) NOT NULL COMMENT '拟合时间',
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
    created_by VARCHAR(50) DEFAULT NULL COMMENT '创建人',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_curves_device_type_method_version (device_id, curve_type, fitting_method, version),
    INDEX idx_curves_device_id (device_id),
    INDEX idx_curves_type (curve_type),
    INDEX idx_curves_method (fitting_method),
    INDEX idx_curves_active (is_active),
    INDEX idx_curves_r_squared (r_squared),
    INDEX idx_curves_fitting_date (fitting_date),
    
    CONSTRAINT fk_curves_device_id FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='特性曲线拟合结果表';
```

### 2.5 优化结果表 (optimization_results)

```sql
CREATE TABLE optimization_results (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '优化结果ID',
    task_id VARCHAR(50) NOT NULL COMMENT '优化任务ID',
    station_id BIGINT UNSIGNED NOT NULL COMMENT '泵站ID',
    optimization_type ENUM('single_objective', 'multi_objective') NOT NULL COMMENT '优化类型',
    
    -- 优化目标和约束
    objectives JSON NOT NULL COMMENT '优化目标配置',
    constraints JSON NOT NULL COMMENT '约束条件',
    
    -- 优化算法信息
    algorithms_used JSON NOT NULL COMMENT '使用的算法列表',
    best_algorithm VARCHAR(50) NOT NULL COMMENT '最佳算法',
    
    -- 优化结果
    best_solution JSON NOT NULL COMMENT '最优解',
    objective_values JSON NOT NULL COMMENT '目标函数值',
    pareto_front JSON DEFAULT NULL COMMENT 'Pareto前沿（多目标优化）',
    
    -- 性能指标
    convergence_generation INT DEFAULT NULL COMMENT '收敛代数',
    execution_time_seconds DECIMAL(8,3) NOT NULL COMMENT '执行时间（秒）',
    solution_quality_score DECIMAL(6,5) NOT NULL COMMENT '解质量分数',
    
    -- 改进效果
    energy_savings_percent DECIMAL(5,2) DEFAULT NULL COMMENT '节能百分比',
    cost_reduction_percent DECIMAL(5,2) DEFAULT NULL COMMENT '成本降低百分比',
    efficiency_improvement_percent DECIMAL(5,2) DEFAULT NULL COMMENT '效率提升百分比',
    
    -- 应用状态
    is_applied BOOLEAN DEFAULT FALSE COMMENT '是否已应用',
    applied_at TIMESTAMP(3) DEFAULT NULL COMMENT '应用时间',
    application_status ENUM('pending', 'applied', 'rolled_back', 'failed') DEFAULT 'pending' COMMENT '应用状态',
    
    -- 时间信息
    optimization_start_time TIMESTAMP(3) NOT NULL COMMENT '优化开始时间',
    optimization_end_time TIMESTAMP(3) NOT NULL COMMENT '优化结束时间',
    target_time_range_start TIMESTAMP(3) NOT NULL COMMENT '目标时间范围开始',
    target_time_range_end TIMESTAMP(3) NOT NULL COMMENT '目标时间范围结束',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
    created_by VARCHAR(50) DEFAULT NULL COMMENT '创建人',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_optimization_task_id (task_id),
    INDEX idx_optimization_station_id (station_id),
    INDEX idx_optimization_type (optimization_type),
    INDEX idx_optimization_algorithm (best_algorithm),
    INDEX idx_optimization_applied (is_applied),
    INDEX idx_optimization_start_time (optimization_start_time),
    INDEX idx_optimization_quality (solution_quality_score),
    
    CONSTRAINT fk_optimization_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='优化结果表';
```

### 2.6 数据补齐记录表 (data_completion_records)

```sql
CREATE TABLE data_completion_records (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '补齐记录ID',
    completion_id VARCHAR(50) NOT NULL COMMENT '补齐任务ID',
    station_id BIGINT UNSIGNED NOT NULL COMMENT '泵站ID',
    device_id BIGINT UNSIGNED NOT NULL COMMENT '设备ID',
    
    -- 补齐范围
    time_range_start TIMESTAMP(3) NOT NULL COMMENT '补齐时间范围开始',
    time_range_end TIMESTAMP(3) NOT NULL COMMENT '补齐时间范围结束',
    parameter_types JSON NOT NULL COMMENT '补齐的参数类型列表',
    
    -- 缺失数据统计
    total_gaps_detected INT UNSIGNED NOT NULL COMMENT '检测到的总缺失段数',
    total_missing_points BIGINT UNSIGNED NOT NULL COMMENT '总缺失数据点数',
    
    -- 补齐方法和结果
    filling_methods JSON NOT NULL COMMENT '使用的补齐方法',
    primary_method VARCHAR(50) NOT NULL COMMENT '主要补齐方法',
    fallback_method VARCHAR(50) DEFAULT NULL COMMENT '备用补齐方法',
    
    -- 补齐统计
    filled_gaps INT UNSIGNED NOT NULL COMMENT '成功补齐的缺失段数',
    filled_points BIGINT UNSIGNED NOT NULL COMMENT '成功补齐的数据点数',
    failed_gaps INT UNSIGNED NOT NULL COMMENT '补齐失败的缺失段数',
    success_rate DECIMAL(5,2) NOT NULL COMMENT '补齐成功率',
    
    -- 质量评估
    overall_confidence DECIMAL(4,3) NOT NULL COMMENT '整体置信度',
    physics_consistency_score DECIMAL(4,3) DEFAULT NULL COMMENT '物理一致性分数',
    temporal_smoothness_score DECIMAL(4,3) DEFAULT NULL COMMENT '时间平滑性分数',
    
    -- 执行信息
    execution_start_time TIMESTAMP(3) NOT NULL COMMENT '执行开始时间',
    execution_end_time TIMESTAMP(3) NOT NULL COMMENT '执行结束时间',
    execution_duration_seconds DECIMAL(8,3) NOT NULL COMMENT '执行时长（秒）',
    
    status ENUM('processing', 'completed', 'failed', 'cancelled') NOT NULL DEFAULT 'processing' COMMENT '补齐状态',
    error_message TEXT DEFAULT NULL COMMENT '错误信息',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
    created_by VARCHAR(50) DEFAULT NULL COMMENT '创建人',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_completion_id (completion_id),
    INDEX idx_completion_station_device (station_id, device_id),
    INDEX idx_completion_time_range (time_range_start, time_range_end),
    INDEX idx_completion_status (status),
    INDEX idx_completion_method (primary_method),
    INDEX idx_completion_success_rate (success_rate),
    
    CONSTRAINT fk_completion_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_completion_device_id FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='数据补齐记录表';
```

### 2.7 系统配置表 (system_configurations)

```sql
CREATE TABLE system_configurations (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '配置ID',
    config_key VARCHAR(100) NOT NULL COMMENT '配置键',
    config_value TEXT NOT NULL COMMENT '配置值',
    config_type ENUM('string', 'integer', 'float', 'boolean', 'json') NOT NULL DEFAULT 'string' COMMENT '配置类型',
    category VARCHAR(50) NOT NULL COMMENT '配置分类',
    description TEXT DEFAULT NULL COMMENT '配置描述',

    is_system BOOLEAN DEFAULT FALSE COMMENT '是否系统配置',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
    created_by VARCHAR(50) DEFAULT NULL COMMENT '创建人',
    updated_by VARCHAR(50) DEFAULT NULL COMMENT '更新人',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_config_key (config_key),
    INDEX idx_config_category (category),
    INDEX idx_config_system (is_system)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统配置表';
```

### 2.8 数据导入任务表 (data_import_tasks)

```sql
CREATE TABLE data_import_tasks (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '导入任务ID',
    import_id VARCHAR(50) NOT NULL COMMENT '导入任务唯一标识',
    station_id BIGINT UNSIGNED NOT NULL COMMENT '泵站ID',
    device_id BIGINT UNSIGNED DEFAULT NULL COMMENT '设备ID（可选）',
    
    -- 文件信息
    file_path VARCHAR(500) NOT NULL COMMENT '文件路径',
    file_name VARCHAR(200) NOT NULL COMMENT '文件名',
    file_size BIGINT UNSIGNED NOT NULL COMMENT '文件大小（字节）',
    file_hash VARCHAR(64) DEFAULT NULL COMMENT '文件哈希值',
    
    -- 导入配置
    import_config JSON NOT NULL COMMENT '导入配置（字段映射、时间格式等）',
    data_source VARCHAR(50) NOT NULL DEFAULT 'csv' COMMENT '数据源类型',
    
    -- 进度统计
    total_records BIGINT UNSIGNED DEFAULT 0 COMMENT '总记录数',
    processed_records BIGINT UNSIGNED DEFAULT 0 COMMENT '已处理记录数',
    successful_records BIGINT UNSIGNED DEFAULT 0 COMMENT '成功记录数',
    failed_records BIGINT UNSIGNED DEFAULT 0 COMMENT '失败记录数',
    duplicate_records BIGINT UNSIGNED DEFAULT 0 COMMENT '重复记录数',
    
    -- 性能指标
    processing_rate DECIMAL(8,2) DEFAULT NULL COMMENT '处理速率（记录/秒）',
    throughput_mbps DECIMAL(8,2) DEFAULT NULL COMMENT '吞吐量（MB/s）',
    
    -- 时间信息
    start_time TIMESTAMP(3) DEFAULT NULL COMMENT '开始时间',
    end_time TIMESTAMP(3) DEFAULT NULL COMMENT '结束时间',
    duration_seconds DECIMAL(8,3) DEFAULT NULL COMMENT '持续时间（秒）',
    estimated_completion TIMESTAMP(3) DEFAULT NULL COMMENT '预计完成时间',
    
    -- 状态和错误
    status ENUM('pending', 'processing', 'completed', 'failed', 'cancelled') NOT NULL DEFAULT 'pending' COMMENT '导入状态',
    error_message TEXT DEFAULT NULL COMMENT '错误信息',
    error_details JSON DEFAULT NULL COMMENT '详细错误信息',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT '更新时间',
    created_by VARCHAR(50) DEFAULT NULL COMMENT '创建人',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_import_id (import_id),
    INDEX idx_import_station_id (station_id),
    INDEX idx_import_device_id (device_id),
    INDEX idx_import_status (status),
    INDEX idx_import_start_time (start_time),
    INDEX idx_import_file_hash (file_hash),
    
    CONSTRAINT fk_import_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_import_device_id FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='数据导入任务表';
```

### 2.9 系统日志表 (system_logs)

```sql
CREATE TABLE system_logs (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT '日志ID',
    log_level ENUM('DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL') NOT NULL COMMENT '日志级别',
    component VARCHAR(50) NOT NULL COMMENT '组件名称',
    operation VARCHAR(100) NOT NULL COMMENT '操作名称',
    message TEXT NOT NULL COMMENT '日志消息',
    details JSON DEFAULT NULL COMMENT '详细信息',
    
    -- 关联信息
    station_id BIGINT UNSIGNED DEFAULT NULL COMMENT '关联泵站ID',
    device_id BIGINT UNSIGNED DEFAULT NULL COMMENT '关联设备ID',
    user_id VARCHAR(50) DEFAULT NULL COMMENT '用户ID',
    session_id VARCHAR(100) DEFAULT NULL COMMENT '会话ID',
    request_id VARCHAR(100) DEFAULT NULL COMMENT '请求ID',
    
    -- 性能信息
    execution_time_ms DECIMAL(10,3) DEFAULT NULL COMMENT '执行时间（毫秒）',
    memory_usage_mb DECIMAL(8,2) DEFAULT NULL COMMENT '内存使用（MB）',
    
    -- 网络信息
    ip_address VARCHAR(45) DEFAULT NULL COMMENT 'IP地址',
    user_agent TEXT DEFAULT NULL COMMENT '用户代理',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT '创建时间',
    
    PRIMARY KEY (id),
    INDEX idx_logs_level (log_level),
    INDEX idx_logs_component (component),
    INDEX idx_logs_operation (operation),
    INDEX idx_logs_created_at (created_at),
    INDEX idx_logs_station_id (station_id),
    INDEX idx_logs_device_id (device_id),
    INDEX idx_logs_user_id (user_id),
    INDEX idx_logs_request_id (request_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='系统日志表'
PARTITION BY RANGE (UNIX_TIMESTAMP(created_at)) (
    PARTITION p_logs_202501 VALUES LESS THAN (UNIX_TIMESTAMP('2025-02-01 00:00:00')),
    PARTITION p_logs_202502 VALUES LESS THAN (UNIX_TIMESTAMP('2025-03-01 00:00:00')),
    PARTITION p_logs_202503 VALUES LESS THAN (UNIX_TIMESTAMP('2025-04-01 00:00:00')),
    PARTITION p_logs_202504 VALUES LESS THAN (UNIX_TIMESTAMP('2025-05-01 00:00:00')),
    PARTITION p_logs_202505 VALUES LESS THAN (UNIX_TIMESTAMP('2025-06-01 00:00:00')),
    PARTITION p_logs_202506 VALUES LESS THAN (UNIX_TIMESTAMP('2025-07-01 00:00:00')),
    PARTITION p_logs_future VALUES LESS THAN MAXVALUE
);
```

## 3. 视图设计

### 3.1 设备运行状态视图

```sql
CREATE VIEW v_device_status AS
SELECT 
    d.id AS device_id,
    d.device_name,
    d.device_code,
    d.device_type,
    s.station_name,
    s.station_code,
    d.status AS device_status,
    d.rated_power,
    d.rated_flow,
    d.rated_head,
    -- 最新运行数据
    latest_data.latest_time,
    latest_data.active_power,
    latest_data.frequency,
    latest_data.efficiency,
    -- 特性曲线信息
    curve_info.curve_count,
    curve_info.best_r_squared,
    curve_info.latest_fitting_date
FROM devices d
INNER JOIN stations s ON d.station_id = s.id
LEFT JOIN (
    SELECT 
        device_id,
        MAX(data_time) AS latest_time,
        MAX(CASE WHEN parameter_type = 'active_power' THEN data_value END) AS active_power,
        MAX(CASE WHEN parameter_type = 'frequency' THEN data_value END) AS frequency,
        MAX(CASE WHEN parameter_type = 'efficiency' THEN data_value END) AS efficiency
    FROM operation_data 
    WHERE data_time >= DATE_SUB(NOW(), INTERVAL 1 HOUR)
    GROUP BY device_id
) latest_data ON d.id = latest_data.device_id
LEFT JOIN (
    SELECT 
        device_id,
        COUNT(*) AS curve_count,
        MAX(r_squared) AS best_r_squared,
        MAX(fitting_date) AS latest_fitting_date
    FROM characteristic_curves 
    WHERE is_active = TRUE
    GROUP BY device_id
) curve_info ON d.id = curve_info.device_id;
```

### 3.2 运行效率统计视图

```sql
CREATE VIEW v_efficiency_statistics AS
SELECT 
    s.id AS station_id,
    s.station_name,
    d.id AS device_id,
    d.device_name,
    DATE(od.data_time) AS date,
    AVG(CASE WHEN od.parameter_type = 'efficiency' THEN od.data_value END) AS avg_efficiency,
    MAX(CASE WHEN od.parameter_type = 'efficiency' THEN od.data_value END) AS max_efficiency,
    MIN(CASE WHEN od.parameter_type = 'efficiency' THEN od.data_value END) AS min_efficiency,
    AVG(CASE WHEN od.parameter_type = 'active_power' THEN od.data_value END) AS avg_power,
    AVG(CASE WHEN od.parameter_type = 'flow_rate' THEN od.data_value END) AS avg_flow,
    COUNT(*) AS data_points
FROM operation_data od
INNER JOIN devices d ON od.device_id = d.id
INNER JOIN stations s ON od.station_id = s.id
WHERE od.parameter_type IN ('efficiency', 'active_power', 'flow_rate')
    AND od.data_time >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
GROUP BY s.id, s.station_name, d.id, d.device_name, DATE(od.data_time);
```

## 4. 存储过程

### 4.1 批量插入运行数据存储过程

```sql
DELIMITER //

CREATE PROCEDURE sp_batch_insert_operation_data(
    IN p_station_id BIGINT UNSIGNED,
    IN p_device_id BIGINT UNSIGNED,
    IN p_data JSON
)
BEGIN
    DECLARE v_error_count INT DEFAULT 0;
    DECLARE v_success_count INT DEFAULT 0;
    DECLARE v_duplicate_count INT DEFAULT 0;
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;
    
    START TRANSACTION;
    
    -- 创建临时表
    CREATE TEMPORARY TABLE temp_operation_data (
        tag_name VARCHAR(200),
        data_time TIMESTAMP(3),
        data_value DECIMAL(15,6),
        parameter_type VARCHAR(50),
        unit VARCHAR(20)
    );
    
    -- 插入JSON数据到临时表
    INSERT INTO temp_operation_data (tag_name, data_time, data_value, parameter_type, unit)
    SELECT 
        JSON_UNQUOTE(JSON_EXTRACT(value, '$.tag_name')),
        STR_TO_DATE(JSON_UNQUOTE(JSON_EXTRACT(value, '$.data_time')), '%Y-%m-%d %H:%i:%s.%f'),
        CAST(JSON_UNQUOTE(JSON_EXTRACT(value, '$.data_value')) AS DECIMAL(15,6)),
        JSON_UNQUOTE(JSON_EXTRACT(value, '$.parameter_type')),
        JSON_UNQUOTE(JSON_EXTRACT(value, '$.unit'))
    FROM JSON_TABLE(p_data, '$[*]' COLUMNS (
        value JSON PATH '$'
    )) AS jt;
    
    -- 批量插入，忽略重复数据
    INSERT IGNORE INTO operation_data (
        station_id, device_id, tag_name, data_time, data_value, parameter_type, unit
    )
    SELECT 
        p_station_id,
        p_device_id,
        tag_name,
        data_time,
        data_value,
        parameter_type,
        unit
    FROM temp_operation_data
    WHERE data_time IS NOT NULL AND data_value IS NOT NULL;
    
    -- 获取统计信息
    SELECT ROW_COUNT() AS inserted_count;
    
    DROP TEMPORARY TABLE temp_operation_data;
    
    COMMIT;
END //

DELIMITER ;
```

### 4.2 数据质量检查存储过程

```sql
DELIMITER //

CREATE PROCEDURE sp_data_quality_check(
    IN p_station_id BIGINT UNSIGNED,
    IN p_device_id BIGINT UNSIGNED,
    IN p_start_time TIMESTAMP(3),
    IN p_end_time TIMESTAMP(3)
)
BEGIN
    DECLARE v_total_points BIGINT DEFAULT 0;
    DECLARE v_missing_points BIGINT DEFAULT 0;
    DECLARE v_outlier_points BIGINT DEFAULT 0;
    DECLARE v_duplicate_points BIGINT DEFAULT 0;
    
    -- 总数据点数
    SELECT COUNT(*) INTO v_total_points
    FROM operation_data
    WHERE station_id = p_station_id
        AND device_id = p_device_id
        AND data_time BETWEEN p_start_time AND p_end_time;
    
    -- 检查缺失数据（基于预期的1秒间隔）
    SELECT 
        TIMESTAMPDIFF(SECOND, p_start_time, p_end_time) - COUNT(DISTINCT data_time) INTO v_missing_points
    FROM operation_data
    WHERE station_id = p_station_id
        AND device_id = p_device_id
        AND data_time BETWEEN p_start_time AND p_end_time;
    
    -- 检查异常值（使用3σ原则）
    SELECT COUNT(*) INTO v_outlier_points
    FROM operation_data od1
    WHERE station_id = p_station_id
        AND device_id = p_device_id
        AND data_time BETWEEN p_start_time AND p_end_time
        AND ABS(data_value - (
            SELECT AVG(data_value)
            FROM operation_data od2
            WHERE od2.station_id = od1.station_id
                AND od2.device_id = od1.device_id
                AND od2.parameter_type = od1.parameter_type
                AND od2.data_time BETWEEN p_start_time AND p_end_time
        )) > 3 * (
            SELECT STDDEV(data_value)
            FROM operation_data od3
            WHERE od3.station_id = od1.station_id
                AND od3.device_id = od1.device_id
                AND od3.parameter_type = od1.parameter_type
                AND od3.data_time BETWEEN p_start_time AND p_end_time
        );
    
    -- 检查重复数据
    SELECT COUNT(*) - COUNT(DISTINCT station_id, device_id, tag_name, data_time) INTO v_duplicate_points
    FROM operation_data
    WHERE station_id = p_station_id
        AND device_id = p_device_id
        AND data_time BETWEEN p_start_time AND p_end_time;
    
    -- 返回质量报告
    SELECT 
        v_total_points AS total_points,
        v_missing_points AS missing_points,
        v_outlier_points AS outlier_points,
        v_duplicate_points AS duplicate_points,
        ROUND((v_total_points - v_missing_points - v_outlier_points) / v_total_points * 100, 2) AS quality_score;
END //

DELIMITER ;
```

## 5. 触发器

### 5.1 设备状态变更日志触发器

```sql
DELIMITER //

CREATE TRIGGER tr_devices_status_change
AFTER UPDATE ON devices
FOR EACH ROW
BEGIN
    IF OLD.status != NEW.status THEN
        INSERT INTO system_logs (
            log_level, component, operation, message, details,
            station_id, device_id, created_at
        ) VALUES (
            'INFO',
            'device_management',
            'status_change',
            CONCAT('设备状态变更: ', OLD.device_name, ' 从 ', OLD.status, ' 变更为 ', NEW.status),
            JSON_OBJECT(
                'device_id', NEW.id,
                'device_name', NEW.device_name,
                'old_status', OLD.status,
                'new_status', NEW.status,
                'updated_by', NEW.updated_by
            ),
            NEW.station_id,
            NEW.id,
            NOW(3)
        );
    END IF;
END //

DELIMITER ;
```

### 5.2 运行数据异常值检测触发器

```sql
DELIMITER //

CREATE TRIGGER tr_operation_data_anomaly_detection
AFTER INSERT ON operation_data
FOR EACH ROW
BEGIN
    DECLARE v_avg_value DECIMAL(15,6);
    DECLARE v_std_value DECIMAL(15,6);
    DECLARE v_threshold DECIMAL(15,6);
    
    -- 计算最近24小时同类型参数的平均值和标准差
    SELECT AVG(data_value), STDDEV(data_value)
    INTO v_avg_value, v_std_value
    FROM operation_data
    WHERE device_id = NEW.device_id
        AND parameter_type = NEW.parameter_type
        AND data_time >= DATE_SUB(NEW.data_time, INTERVAL 24 HOUR)
        AND data_time < NEW.data_time;
    
    -- 如果有足够的历史数据进行比较
    IF v_avg_value IS NOT NULL AND v_std_value IS NOT NULL AND v_std_value > 0 THEN
        SET v_threshold = 3 * v_std_value;
        
        -- 检查是否为异常值（3σ原则）
        IF ABS(NEW.data_value - v_avg_value) > v_threshold THEN
            INSERT INTO system_logs (
                log_level, component, operation, message, details,
                station_id, device_id, created_at
            ) VALUES (
                'WARNING',
                'data_quality',
                'anomaly_detection',
                CONCAT('检测到异常数据值: ', NEW.parameter_type, ' = ', NEW.data_value),
                JSON_OBJECT(
                    'data_id', NEW.id,
                    'device_id', NEW.device_id,
                    'parameter_type', NEW.parameter_type,
                    'data_value', NEW.data_value,
                    'expected_range', JSON_OBJECT(
                        'mean', v_avg_value,
                        'std', v_std_value,
                        'threshold', v_threshold
                    ),
                    'deviation', ABS(NEW.data_value - v_avg_value)
                ),
                NEW.station_id,
                NEW.device_id,
                NOW(3)
            );
        END IF;
    END IF;
END //

DELIMITER ;
```

## 6. 索引优化策略

### 6.1 复合索引设计原则

1. **查询频率优先**: 最常用的查询条件放在索引前面
2. **选择性优先**: 选择性高的字段放在前面
3. **范围查询最后**: 范围查询字段放在索引最后

### 6.2 关键索引

```sql
-- 运行数据表的关键索引
CREATE INDEX idx_operation_data_device_time_param ON operation_data(device_id, data_time, parameter_type);
CREATE INDEX idx_operation_data_station_time ON operation_data(station_id, data_time);
CREATE INDEX idx_operation_data_time_param ON operation_data(data_time, parameter_type);

-- 特性曲线表的关键索引
CREATE INDEX idx_curves_device_type_active ON characteristic_curves(device_id, curve_type, is_active);
CREATE INDEX idx_curves_r_squared_desc ON characteristic_curves(r_squared DESC);

-- 优化结果表的关键索引
CREATE INDEX idx_optimization_station_time ON optimization_results(station_id, optimization_start_time);
CREATE INDEX idx_optimization_quality_desc ON optimization_results(solution_quality_score DESC);
```

## 7. 分区策略

### 7.1 时间分区

运行数据表和日志表采用按月分区策略：

```sql
-- 自动创建新分区的存储过程
DELIMITER //

CREATE PROCEDURE sp_create_monthly_partitions(
    IN p_table_name VARCHAR(64),
    IN p_months_ahead INT
)
BEGIN
    DECLARE v_partition_name VARCHAR(64);
    DECLARE v_partition_value VARCHAR(64);
    DECLARE v_current_date DATE;
    DECLARE v_counter INT DEFAULT 0;
    
    SET v_current_date = LAST_DAY(CURDATE()) + INTERVAL 1 DAY;
    
    WHILE v_counter < p_months_ahead DO
        SET v_partition_name = CONCAT('p', DATE_FORMAT(v_current_date, '%Y%m'));
        SET v_partition_value = UNIX_TIMESTAMP(v_current_date + INTERVAL 1 MONTH);
        
        SET @sql = CONCAT(
            'ALTER TABLE ', p_table_name,
            ' ADD PARTITION (PARTITION ', v_partition_name,
            ' VALUES LESS THAN (', v_partition_value, '))'
        );
        
        PREPARE stmt FROM @sql;
        EXECUTE stmt;
        DEALLOCATE PREPARE stmt;
        
        SET v_current_date = v_current_date + INTERVAL 1 MONTH;
        SET v_counter = v_counter + 1;
    END WHILE;
END //

DELIMITER ;
```

### 7.2 分区维护

```sql
-- 删除旧分区的存储过程
DELIMITER //

CREATE PROCEDURE sp_drop_old_partitions(
    IN p_table_name VARCHAR(64),
    IN p_keep_months INT
)
BEGIN
    DECLARE v_partition_name VARCHAR(64);
    DECLARE v_cutoff_date DATE;
    DECLARE done INT DEFAULT FALSE;
    DECLARE partition_cursor CURSOR FOR
        SELECT PARTITION_NAME
        FROM INFORMATION_SCHEMA.PARTITIONS
        WHERE TABLE_SCHEMA = DATABASE()
            AND TABLE_NAME = p_table_name
            AND PARTITION_NAME IS NOT NULL
            AND PARTITION_NAME != 'p_future'
            AND PARTITION_NAME < CONCAT('p', DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL p_keep_months MONTH), '%Y%m'));
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    OPEN partition_cursor;
    
    read_loop: LOOP
        FETCH partition_cursor INTO v_partition_name;
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        SET @sql = CONCAT('ALTER TABLE ', p_table_name, ' DROP PARTITION ', v_partition_name);
        PREPARE stmt FROM @sql;
        EXECUTE stmt;
        DEALLOCATE PREPARE stmt;
    END LOOP;
    
    CLOSE partition_cursor;
END //

DELIMITER ;
```

## 8. 性能优化配置

### 8.1 MySQL配置优化

```ini
# my.cnf 关键配置
[mysqld]
# 基础配置
default-storage-engine = InnoDB
default-table-type = InnoDB
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# 内存配置
innodb_buffer_pool_size = 4G
innodb_log_file_size = 512M
innodb_log_buffer_size = 64M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# 并发配置
innodb_thread_concurrency = 0
innodb_read_io_threads = 8
innodb_write_io_threads = 8
max_connections = 500
thread_cache_size = 50

# 查询缓存
query_cache_type = 1
query_cache_size = 256M
query_cache_limit = 2M

# 临时表
tmp_table_size = 256M
max_heap_table_size = 256M

# 二进制日志
log-bin = mysql-bin
binlog_format = ROW
expire_logs_days = 7

# 慢查询日志
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1
```

### 8.2 批量插入优化

```sql
-- 批量插入优化设置
SET autocommit = 0;
SET unique_checks = 0;
SET foreign_key_checks = 0;

-- 执行批量插入
INSERT INTO operation_data (station_id, device_id, tag_name, data_time, data_value, parameter_type) VALUES
(1, 1, 'tag1', '2025-01-28 10:00:00.000', 45.5, 'active_power'),
(1, 1, 'tag2', '2025-01-28 10:00:01.000', 46.2, 'active_power'),
-- ... 更多数据
;

-- 恢复设置
SET foreign_key_checks = 1;
SET unique_checks = 1;
COMMIT;
SET autocommit = 1;
```

## 9. 数据备份与恢复

### 9.1 备份策略

```bash
#!/bin/bash
# 数据库备份脚本

DB_NAME="pump_station_optimization"
BACKUP_DIR="/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)

# 全量备份
mysqldump --single-transaction --routines --triggers \
    --master-data=2 --flush-logs \
    --databases $DB_NAME > $BACKUP_DIR/full_backup_$DATE.sql

# 压缩备份文件
gzip $BACKUP_DIR/full_backup_$DATE.sql

# 删除7天前的备份
find $BACKUP_DIR -name "full_backup_*.sql.gz" -mtime +7 -delete

# 增量备份（二进制日志）
mysqlbinlog --start-datetime="$(date -d '1 day ago' '+%Y-%m-%d %H:%M:%S')" \
    /var/lib/mysql/mysql-bin.* > $BACKUP_DIR/incremental_backup_$DATE.sql
```

### 9.2 恢复脚本

```bash
#!/bin/bash
# 数据库恢复脚本

BACKUP_FILE=$1
DB_NAME="pump_station_optimization"

if [ -z "$BACKUP_FILE" ]; then
    echo "Usage: $0 <backup_file>"
    exit 1
fi

# 停止应用服务
systemctl stop pump-station-api

# 恢复数据库
if [[ $BACKUP_FILE == *.gz ]]; then
    gunzip -c $BACKUP_FILE | mysql $DB_NAME
else
    mysql $DB_NAME < $BACKUP_FILE
fi

# 重启应用服务
systemctl start pump-station-api

echo "Database restored from $BACKUP_FILE"
```

## 10. 监控与维护

### 10.1 性能监控查询

```sql
-- 查看表大小和行数
SELECT 
    TABLE_NAME,
    ROUND(((DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024), 2) AS 'Size (MB)',
    TABLE_ROWS
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'pump_station_optimization'
ORDER BY (DATA_LENGTH + INDEX_LENGTH) DESC;

-- 查看索引使用情况
SELECT 
    TABLE_NAME,
    INDEX_NAME,
    CARDINALITY,
    ROUND(CARDINALITY / TABLE_ROWS * 100, 2) AS 'Selectivity %'
FROM information_schema.STATISTICS s
JOIN information_schema.TABLES t ON s.TABLE_NAME = t.TABLE_NAME
WHERE s.TABLE_SCHEMA = 'pump_station_optimization'
    AND t.TABLE_SCHEMA = 'pump_station_optimization'
ORDER BY TABLE_NAME, INDEX_NAME;

-- 查看慢查询
SELECT 
    query_time,
    lock_time,
    rows_sent,
    rows_examined,
    sql_text
FROM mysql.slow_log
WHERE start_time >= DATE_SUB(NOW(), INTERVAL 1 DAY)
ORDER BY query_time DESC
LIMIT 10;
```

### 10.2 维护任务

```sql
-- 定期优化表
OPTIMIZE TABLE operation_data;
OPTIMIZE TABLE characteristic_curves;
OPTIMIZE TABLE optimization_results;

-- 更新表统计信息
ANALYZE TABLE operation_data;
ANALYZE TABLE characteristic_curves;
ANALYZE TABLE optimization_results;

-- 检查表完整性
CHECK TABLE operation_data;
CHECK TABLE characteristic_curves;
CHECK TABLE optimization_results;
```



---

**文档版本**: v1.0  
**最后更新**: 2025-01-28  
**维护团队**: 泵站优化系统开发团队  
**审核状态**: 待审核