# æ³µç«™è¿è¡Œæ•°æ®ä¼˜åŒ–ç³»ç»Ÿ - æ•°æ®åº“è®¾è®¡æ–‡æ¡£

## ğŸ”§ å¦‚ä½•ä½¿ç”¨æœ¬è§„èŒƒ
- å»ºæ¨¡æµç¨‹ï¼šéœ€æ±‚â†’å®ä½“â†’å…³ç³»â†’æŒ‡æ ‡â†’çº¦æŸâ†’ç´¢å¼•â†’åˆ†åŒºâ†’å®¡è®¡â†’å˜æ›´è„šæœ¬
- å®¡æ ¸æ¸…å•ï¼šä¸»å¤–é”®ã€å”¯ä¸€çº¦æŸã€æ—¶é—´ç²¾åº¦ã€å­—ç¬¦é›†ã€ç´¢å¼•è¦†ç›–ã€è½¯åˆ é™¤/å®¡è®¡å­—æ®µ
- æ€§èƒ½ï¼šçƒ­ç‚¹å­—æ®µç´¢å¼•ã€å†™å¤šè¯»å°‘è¡¨çš„æ‰¹é‡å†™ç­–ç•¥ã€å†å²è¡¨/å½’æ¡£ç­–ç•¥
- å˜æ›´ï¼šæ‰€æœ‰DDLé€šè¿‡è„šæœ¬æ‰§è¡Œï¼Œå¸¦å›æ»šï¼›ç”Ÿæˆå˜æ›´è¯´æ˜

---

## 1. æ•°æ®åº“æ¦‚è¿°

### 1.1 åŸºæœ¬ä¿¡æ¯
- **æ•°æ®åº“ç±»å‹**: MySQL 8.0.12
- **å­—ç¬¦é›†**: utf8mb4
- **æ’åºè§„åˆ™**: utf8mb4_unicode_ci
- **æ—¶åŒº**: UTC
- **æ•°æ®åº“åç§°**: `pump_station_optimization`

### 1.2 è®¾è®¡åŸåˆ™
- **æ•°æ®ä¸€è‡´æ€§**: ä¸¥æ ¼çš„å¤–é”®çº¦æŸå’Œäº‹åŠ¡æ§åˆ¶
- **æ€§èƒ½ä¼˜åŒ–**: åˆç†çš„ç´¢å¼•è®¾è®¡å’Œåˆ†åŒºç­–ç•¥
- **æ‰©å±•æ€§**: æ”¯æŒæ°´å¹³å’Œå‚ç›´æ‰©å±•
- **æ•°æ®å®Œæ•´æ€§**: å®Œå–„çš„çº¦æŸæ¡ä»¶å’Œè§¦å‘å™¨
- **æ—¶é—´ç²¾åº¦**: æ¯«ç§’çº§æ—¶é—´æˆ³å­˜å‚¨

### 1.3 å‘½åè§„èŒƒ
- **è¡¨å**: å°å†™å­—æ¯ï¼Œä¸‹åˆ’çº¿åˆ†éš”ï¼Œå¤æ•°å½¢å¼
- **å­—æ®µå**: å°å†™å­—æ¯ï¼Œä¸‹åˆ’çº¿åˆ†éš”
- **ç´¢å¼•å**: `idx_è¡¨å_å­—æ®µå` æˆ– `uk_è¡¨å_å­—æ®µå`ï¼ˆå”¯ä¸€ç´¢å¼•ï¼‰
- **å¤–é”®å**: `fk_è¡¨å_å¼•ç”¨è¡¨å_å­—æ®µå`

## 2. æ ¸å¿ƒè¡¨ç»“æ„è®¾è®¡

### 2.1 æ³µç«™ä¿¡æ¯è¡¨ (stations)

```sql
CREATE TABLE stations (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ³µç«™ID',
    station_name VARCHAR(100) NOT NULL COMMENT 'æ³µç«™åç§°',
    station_code VARCHAR(50) NOT NULL COMMENT 'æ³µç«™ç¼–ç ',
    station_type ENUM('supply', 'intake') NOT NULL COMMENT 'æ³µç«™ç±»å‹ï¼šä¾›æ°´/å–æ°´',
    phase ENUM('phase1', 'phase2', 'phase3') NOT NULL COMMENT 'æœŸæ•°',
    location VARCHAR(200) DEFAULT NULL COMMENT 'ä½ç½®æè¿°',
    capacity DECIMAL(10,2) DEFAULT NULL COMMENT 'è®¾è®¡å®¹é‡(mÂ³/h)',
    longitude DECIMAL(10,7) DEFAULT NULL COMMENT 'ç»åº¦',
    latitude DECIMAL(10,7) DEFAULT NULL COMMENT 'çº¬åº¦',
    status ENUM('active', 'inactive', 'maintenance') NOT NULL DEFAULT 'active' COMMENT 'çŠ¶æ€',
    description TEXT DEFAULT NULL COMMENT 'æè¿°ä¿¡æ¯',
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'æ›´æ–°æ—¶é—´',
    created_by VARCHAR(50) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
    updated_by VARCHAR(50) DEFAULT NULL COMMENT 'æ›´æ–°äºº',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_stations_code (station_code),
    UNIQUE KEY uk_stations_name (station_name),
    INDEX idx_stations_type_phase (station_type, phase),
    INDEX idx_stations_status (status),
    INDEX idx_stations_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ³µç«™ä¿¡æ¯è¡¨';
```

### 2.2 è®¾å¤‡ä¿¡æ¯è¡¨ (devices)

```sql
CREATE TABLE devices (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'è®¾å¤‡ID',
    station_id BIGINT UNSIGNED NOT NULL COMMENT 'æ‰€å±æ³µç«™ID',
    device_name VARCHAR(100) NOT NULL COMMENT 'è®¾å¤‡åç§°',
    device_code VARCHAR(50) NOT NULL COMMENT 'è®¾å¤‡ç¼–ç ',
    device_type ENUM('pump', 'variable_frequency', 'soft_start') NOT NULL COMMENT 'è®¾å¤‡ç±»å‹',
    device_number VARCHAR(20) NOT NULL COMMENT 'è®¾å¤‡ç¼–å·ï¼ˆå¦‚1#ã€2#ï¼‰',
    
    -- è®¾å¤‡æŠ€æœ¯å‚æ•°
    rated_power DECIMAL(8,2) DEFAULT NULL COMMENT 'é¢å®šåŠŸç‡(kW)',
    rated_flow DECIMAL(8,2) DEFAULT NULL COMMENT 'é¢å®šæµé‡(mÂ³/h)',
    rated_head DECIMAL(8,2) DEFAULT NULL COMMENT 'é¢å®šæ‰¬ç¨‹(m)',
    rated_speed DECIMAL(8,2) DEFAULT NULL COMMENT 'é¢å®šè½¬é€Ÿ(rpm)',
    rated_efficiency DECIMAL(5,4) DEFAULT NULL COMMENT 'é¢å®šæ•ˆç‡',
    
    -- è®¾å¤‡åŸºæœ¬ä¿¡æ¯
    manufacturer VARCHAR(100) DEFAULT NULL COMMENT 'åˆ¶é€ å•†',
    model VARCHAR(100) DEFAULT NULL COMMENT 'å‹å·',
    serial_number VARCHAR(100) DEFAULT NULL COMMENT 'åºåˆ—å·',
    install_date DATE DEFAULT NULL COMMENT 'å®‰è£…æ—¥æœŸ',
    warranty_date DATE DEFAULT NULL COMMENT 'ä¿ä¿®åˆ°æœŸæ—¥æœŸ',
    
    -- è¿è¡Œå‚æ•°èŒƒå›´
    min_frequency DECIMAL(5,2) DEFAULT NULL COMMENT 'æœ€å°è¿è¡Œé¢‘ç‡(Hz)',
    max_frequency DECIMAL(5,2) DEFAULT NULL COMMENT 'æœ€å¤§è¿è¡Œé¢‘ç‡(Hz)',
    min_flow DECIMAL(8,2) DEFAULT NULL COMMENT 'æœ€å°æµé‡(mÂ³/h)',
    max_flow DECIMAL(8,2) DEFAULT NULL COMMENT 'æœ€å¤§æµé‡(mÂ³/h)',
    
    status ENUM('active', 'inactive', 'maintenance', 'fault') NOT NULL DEFAULT 'active' COMMENT 'è®¾å¤‡çŠ¶æ€',
    description TEXT DEFAULT NULL COMMENT 'è®¾å¤‡æè¿°',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'æ›´æ–°æ—¶é—´',
    created_by VARCHAR(50) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
    updated_by VARCHAR(50) DEFAULT NULL COMMENT 'æ›´æ–°äºº',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_devices_code (device_code),
    UNIQUE KEY uk_devices_station_number (station_id, device_number),
    INDEX idx_devices_station_id (station_id),
    INDEX idx_devices_type (device_type),
    INDEX idx_devices_status (status),
    INDEX idx_devices_name (device_name),
    
    CONSTRAINT fk_devices_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è®¾å¤‡ä¿¡æ¯è¡¨';
```

### 2.3 è¿è¡Œæ•°æ®è¡¨ (operation_data)

```sql
CREATE TABLE operation_data (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ•°æ®ID',
    station_id BIGINT UNSIGNED NOT NULL COMMENT 'æ³µç«™ID',
    device_id BIGINT UNSIGNED NOT NULL COMMENT 'è®¾å¤‡ID',
    tag_name VARCHAR(200) NOT NULL COMMENT 'æ•°æ®æ ‡ç­¾åç§°',
    data_time TIMESTAMP(3) NOT NULL COMMENT 'æ•°æ®æ—¶é—´ï¼ˆç²¾ç¡®åˆ°æ¯«ç§’ï¼‰',
    data_value DECIMAL(15,6) NOT NULL COMMENT 'æ•°æ®å€¼',
    parameter_type VARCHAR(50) NOT NULL COMMENT 'å‚æ•°ç±»å‹',
    unit VARCHAR(20) DEFAULT NULL COMMENT 'å•ä½',
    quality_code TINYINT UNSIGNED DEFAULT 192 COMMENT 'æ•°æ®è´¨é‡ä»£ç ',
    data_source VARCHAR(50) DEFAULT 'scada' COMMENT 'æ•°æ®æ¥æº',
    
    -- æ•°æ®å¤„ç†æ ‡è®°
    is_processed BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²å¤„ç†',
    is_validated BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²éªŒè¯',
    is_filled BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦ä¸ºè¡¥é½æ•°æ®',
    confidence_score DECIMAL(3,2) DEFAULT NULL COMMENT 'ç½®ä¿¡åº¦åˆ†æ•°(0-1)',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'åˆ›å»ºæ—¶é—´',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_operation_data_unique (station_id, device_id, tag_name, data_time),
    INDEX idx_operation_data_station_device (station_id, device_id),
    INDEX idx_operation_data_time (data_time),
    INDEX idx_operation_data_parameter (parameter_type),
    INDEX idx_operation_data_tag (tag_name),
    INDEX idx_operation_data_processed (is_processed),
    INDEX idx_operation_data_filled (is_filled),
    
    CONSTRAINT fk_operation_data_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_operation_data_device_id FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='è¿è¡Œæ•°æ®è¡¨'
PARTITION BY RANGE (UNIX_TIMESTAMP(data_time)) (
    PARTITION p202501 VALUES LESS THAN (UNIX_TIMESTAMP('2025-02-01 00:00:00')),
    PARTITION p202502 VALUES LESS THAN (UNIX_TIMESTAMP('2025-03-01 00:00:00')),
    PARTITION p202503 VALUES LESS THAN (UNIX_TIMESTAMP('2025-04-01 00:00:00')),
    PARTITION p202504 VALUES LESS THAN (UNIX_TIMESTAMP('2025-05-01 00:00:00')),
    PARTITION p202505 VALUES LESS THAN (UNIX_TIMESTAMP('2025-06-01 00:00:00')),
    PARTITION p202506 VALUES LESS THAN (UNIX_TIMESTAMP('2025-07-01 00:00:00')),
    PARTITION p202507 VALUES LESS THAN (UNIX_TIMESTAMP('2025-08-01 00:00:00')),
    PARTITION p202508 VALUES LESS THAN (UNIX_TIMESTAMP('2025-09-01 00:00:00')),
    PARTITION p202509 VALUES LESS THAN (UNIX_TIMESTAMP('2025-10-01 00:00:00')),
    PARTITION p202510 VALUES LESS THAN (UNIX_TIMESTAMP('2025-11-01 00:00:00')),
    PARTITION p202511 VALUES LESS THAN (UNIX_TIMESTAMP('2025-12-01 00:00:00')),
    PARTITION p202512 VALUES LESS THAN (UNIX_TIMESTAMP('2026-01-01 00:00:00')),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

### 2.4 ç‰¹æ€§æ›²çº¿æ‹Ÿåˆç»“æœè¡¨ (characteristic_curves)

```sql
CREATE TABLE characteristic_curves (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ›²çº¿ID',
    device_id BIGINT UNSIGNED NOT NULL COMMENT 'è®¾å¤‡ID',
    curve_type ENUM('head_flow', 'efficiency_flow', 'power_flow', 'npsh_flow') NOT NULL COMMENT 'æ›²çº¿ç±»å‹',
    fitting_method VARCHAR(50) NOT NULL COMMENT 'æ‹Ÿåˆæ–¹æ³•',
    
    -- æ‹Ÿåˆå‚æ•°å’Œç»“æœ
    model_parameters JSON NOT NULL COMMENT 'æ¨¡å‹å‚æ•°ï¼ˆJSONæ ¼å¼ï¼‰',
    model_metadata JSON DEFAULT NULL COMMENT 'æ¨¡å‹å…ƒæ•°æ®',
    
    -- ç²¾åº¦æŒ‡æ ‡
    r_squared DECIMAL(6,5) NOT NULL COMMENT 'RÂ²å†³å®šç³»æ•°',
    rmse DECIMAL(10,6) NOT NULL COMMENT 'å‡æ–¹æ ¹è¯¯å·®',
    mae DECIMAL(10,6) NOT NULL COMMENT 'å¹³å‡ç»å¯¹è¯¯å·®',
    mape DECIMAL(6,3) DEFAULT NULL COMMENT 'å¹³å‡ç»å¯¹ç™¾åˆ†æ¯”è¯¯å·®',
    
    -- éªŒè¯æŒ‡æ ‡
    cross_validation_score DECIMAL(6,5) DEFAULT NULL COMMENT 'äº¤å‰éªŒè¯åˆ†æ•°',
    validation_score DECIMAL(6,5) DEFAULT NULL COMMENT 'éªŒè¯é›†åˆ†æ•°',
    physics_consistency_score DECIMAL(6,5) DEFAULT NULL COMMENT 'ç‰©ç†ä¸€è‡´æ€§åˆ†æ•°',
    
    -- æ•°æ®ä¿¡æ¯
    data_points_count INT UNSIGNED NOT NULL COMMENT 'è®­ç»ƒæ•°æ®ç‚¹æ•°é‡',
    data_time_range_start TIMESTAMP(3) NOT NULL COMMENT 'æ•°æ®æ—¶é—´èŒƒå›´å¼€å§‹',
    data_time_range_end TIMESTAMP(3) NOT NULL COMMENT 'æ•°æ®æ—¶é—´èŒƒå›´ç»“æŸ',
    
    -- é€‚ç”¨èŒƒå›´
    flow_range_min DECIMAL(8,2) DEFAULT NULL COMMENT 'æµé‡èŒƒå›´æœ€å°å€¼',
    flow_range_max DECIMAL(8,2) DEFAULT NULL COMMENT 'æµé‡èŒƒå›´æœ€å¤§å€¼',
    head_range_min DECIMAL(8,2) DEFAULT NULL COMMENT 'æ‰¬ç¨‹èŒƒå›´æœ€å°å€¼',
    head_range_max DECIMAL(8,2) DEFAULT NULL COMMENT 'æ‰¬ç¨‹èŒƒå›´æœ€å¤§å€¼',
    
    -- çŠ¶æ€å’Œç‰ˆæœ¬
    is_active BOOLEAN NOT NULL DEFAULT TRUE COMMENT 'æ˜¯å¦æ¿€æ´»',
    version VARCHAR(20) NOT NULL DEFAULT '1.0' COMMENT 'ç‰ˆæœ¬å·',
    confidence_level ENUM('low', 'medium', 'high') NOT NULL DEFAULT 'medium' COMMENT 'ç½®ä¿¡æ°´å¹³',
    
    fitting_date TIMESTAMP(3) NOT NULL COMMENT 'æ‹Ÿåˆæ—¶é—´',
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'æ›´æ–°æ—¶é—´',
    created_by VARCHAR(50) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_curves_device_type_method_version (device_id, curve_type, fitting_method, version),
    INDEX idx_curves_device_id (device_id),
    INDEX idx_curves_type (curve_type),
    INDEX idx_curves_method (fitting_method),
    INDEX idx_curves_active (is_active),
    INDEX idx_curves_r_squared (r_squared),
    INDEX idx_curves_fitting_date (fitting_date),
    
    CONSTRAINT fk_curves_device_id FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç‰¹æ€§æ›²çº¿æ‹Ÿåˆç»“æœè¡¨';
```

### 2.5 ä¼˜åŒ–ç»“æœè¡¨ (optimization_results)

```sql
CREATE TABLE optimization_results (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'ä¼˜åŒ–ç»“æœID',
    task_id VARCHAR(50) NOT NULL COMMENT 'ä¼˜åŒ–ä»»åŠ¡ID',
    station_id BIGINT UNSIGNED NOT NULL COMMENT 'æ³µç«™ID',
    optimization_type ENUM('single_objective', 'multi_objective') NOT NULL COMMENT 'ä¼˜åŒ–ç±»å‹',
    
    -- ä¼˜åŒ–ç›®æ ‡å’Œçº¦æŸ
    objectives JSON NOT NULL COMMENT 'ä¼˜åŒ–ç›®æ ‡é…ç½®',
    constraints JSON NOT NULL COMMENT 'çº¦æŸæ¡ä»¶',
    
    -- ä¼˜åŒ–ç®—æ³•ä¿¡æ¯
    algorithms_used JSON NOT NULL COMMENT 'ä½¿ç”¨çš„ç®—æ³•åˆ—è¡¨',
    best_algorithm VARCHAR(50) NOT NULL COMMENT 'æœ€ä½³ç®—æ³•',
    
    -- ä¼˜åŒ–ç»“æœ
    best_solution JSON NOT NULL COMMENT 'æœ€ä¼˜è§£',
    objective_values JSON NOT NULL COMMENT 'ç›®æ ‡å‡½æ•°å€¼',
    pareto_front JSON DEFAULT NULL COMMENT 'Paretoå‰æ²¿ï¼ˆå¤šç›®æ ‡ä¼˜åŒ–ï¼‰',
    
    -- æ€§èƒ½æŒ‡æ ‡
    convergence_generation INT DEFAULT NULL COMMENT 'æ”¶æ•›ä»£æ•°',
    execution_time_seconds DECIMAL(8,3) NOT NULL COMMENT 'æ‰§è¡Œæ—¶é—´ï¼ˆç§’ï¼‰',
    solution_quality_score DECIMAL(6,5) NOT NULL COMMENT 'è§£è´¨é‡åˆ†æ•°',
    
    -- æ”¹è¿›æ•ˆæœ
    energy_savings_percent DECIMAL(5,2) DEFAULT NULL COMMENT 'èŠ‚èƒ½ç™¾åˆ†æ¯”',
    cost_reduction_percent DECIMAL(5,2) DEFAULT NULL COMMENT 'æˆæœ¬é™ä½ç™¾åˆ†æ¯”',
    efficiency_improvement_percent DECIMAL(5,2) DEFAULT NULL COMMENT 'æ•ˆç‡æå‡ç™¾åˆ†æ¯”',
    
    -- åº”ç”¨çŠ¶æ€
    is_applied BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦å·²åº”ç”¨',
    applied_at TIMESTAMP(3) DEFAULT NULL COMMENT 'åº”ç”¨æ—¶é—´',
    application_status ENUM('pending', 'applied', 'rolled_back', 'failed') DEFAULT 'pending' COMMENT 'åº”ç”¨çŠ¶æ€',
    
    -- æ—¶é—´ä¿¡æ¯
    optimization_start_time TIMESTAMP(3) NOT NULL COMMENT 'ä¼˜åŒ–å¼€å§‹æ—¶é—´',
    optimization_end_time TIMESTAMP(3) NOT NULL COMMENT 'ä¼˜åŒ–ç»“æŸæ—¶é—´',
    target_time_range_start TIMESTAMP(3) NOT NULL COMMENT 'ç›®æ ‡æ—¶é—´èŒƒå›´å¼€å§‹',
    target_time_range_end TIMESTAMP(3) NOT NULL COMMENT 'ç›®æ ‡æ—¶é—´èŒƒå›´ç»“æŸ',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'æ›´æ–°æ—¶é—´',
    created_by VARCHAR(50) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_optimization_task_id (task_id),
    INDEX idx_optimization_station_id (station_id),
    INDEX idx_optimization_type (optimization_type),
    INDEX idx_optimization_algorithm (best_algorithm),
    INDEX idx_optimization_applied (is_applied),
    INDEX idx_optimization_start_time (optimization_start_time),
    INDEX idx_optimization_quality (solution_quality_score),
    
    CONSTRAINT fk_optimization_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ä¼˜åŒ–ç»“æœè¡¨';
```

### 2.6 æ•°æ®è¡¥é½è®°å½•è¡¨ (data_completion_records)

```sql
CREATE TABLE data_completion_records (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'è¡¥é½è®°å½•ID',
    completion_id VARCHAR(50) NOT NULL COMMENT 'è¡¥é½ä»»åŠ¡ID',
    station_id BIGINT UNSIGNED NOT NULL COMMENT 'æ³µç«™ID',
    device_id BIGINT UNSIGNED NOT NULL COMMENT 'è®¾å¤‡ID',
    
    -- è¡¥é½èŒƒå›´
    time_range_start TIMESTAMP(3) NOT NULL COMMENT 'è¡¥é½æ—¶é—´èŒƒå›´å¼€å§‹',
    time_range_end TIMESTAMP(3) NOT NULL COMMENT 'è¡¥é½æ—¶é—´èŒƒå›´ç»“æŸ',
    parameter_types JSON NOT NULL COMMENT 'è¡¥é½çš„å‚æ•°ç±»å‹åˆ—è¡¨',
    
    -- ç¼ºå¤±æ•°æ®ç»Ÿè®¡
    total_gaps_detected INT UNSIGNED NOT NULL COMMENT 'æ£€æµ‹åˆ°çš„æ€»ç¼ºå¤±æ®µæ•°',
    total_missing_points BIGINT UNSIGNED NOT NULL COMMENT 'æ€»ç¼ºå¤±æ•°æ®ç‚¹æ•°',
    
    -- è¡¥é½æ–¹æ³•å’Œç»“æœ
    filling_methods JSON NOT NULL COMMENT 'ä½¿ç”¨çš„è¡¥é½æ–¹æ³•',
    primary_method VARCHAR(50) NOT NULL COMMENT 'ä¸»è¦è¡¥é½æ–¹æ³•',
    fallback_method VARCHAR(50) DEFAULT NULL COMMENT 'å¤‡ç”¨è¡¥é½æ–¹æ³•',
    
    -- è¡¥é½ç»Ÿè®¡
    filled_gaps INT UNSIGNED NOT NULL COMMENT 'æˆåŠŸè¡¥é½çš„ç¼ºå¤±æ®µæ•°',
    filled_points BIGINT UNSIGNED NOT NULL COMMENT 'æˆåŠŸè¡¥é½çš„æ•°æ®ç‚¹æ•°',
    failed_gaps INT UNSIGNED NOT NULL COMMENT 'è¡¥é½å¤±è´¥çš„ç¼ºå¤±æ®µæ•°',
    success_rate DECIMAL(5,2) NOT NULL COMMENT 'è¡¥é½æˆåŠŸç‡',
    
    -- è´¨é‡è¯„ä¼°
    overall_confidence DECIMAL(4,3) NOT NULL COMMENT 'æ•´ä½“ç½®ä¿¡åº¦',
    physics_consistency_score DECIMAL(4,3) DEFAULT NULL COMMENT 'ç‰©ç†ä¸€è‡´æ€§åˆ†æ•°',
    temporal_smoothness_score DECIMAL(4,3) DEFAULT NULL COMMENT 'æ—¶é—´å¹³æ»‘æ€§åˆ†æ•°',
    
    -- æ‰§è¡Œä¿¡æ¯
    execution_start_time TIMESTAMP(3) NOT NULL COMMENT 'æ‰§è¡Œå¼€å§‹æ—¶é—´',
    execution_end_time TIMESTAMP(3) NOT NULL COMMENT 'æ‰§è¡Œç»“æŸæ—¶é—´',
    execution_duration_seconds DECIMAL(8,3) NOT NULL COMMENT 'æ‰§è¡Œæ—¶é•¿ï¼ˆç§’ï¼‰',
    
    status ENUM('processing', 'completed', 'failed', 'cancelled') NOT NULL DEFAULT 'processing' COMMENT 'è¡¥é½çŠ¶æ€',
    error_message TEXT DEFAULT NULL COMMENT 'é”™è¯¯ä¿¡æ¯',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'æ›´æ–°æ—¶é—´',
    created_by VARCHAR(50) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_completion_id (completion_id),
    INDEX idx_completion_station_device (station_id, device_id),
    INDEX idx_completion_time_range (time_range_start, time_range_end),
    INDEX idx_completion_status (status),
    INDEX idx_completion_method (primary_method),
    INDEX idx_completion_success_rate (success_rate),
    
    CONSTRAINT fk_completion_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_completion_device_id FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ•°æ®è¡¥é½è®°å½•è¡¨';
```

### 2.7 ç³»ç»Ÿé…ç½®è¡¨ (system_configurations)

```sql
CREATE TABLE system_configurations (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'é…ç½®ID',
    config_key VARCHAR(100) NOT NULL COMMENT 'é…ç½®é”®',
    config_value TEXT NOT NULL COMMENT 'é…ç½®å€¼',
    config_type ENUM('string', 'integer', 'float', 'boolean', 'json') NOT NULL DEFAULT 'string' COMMENT 'é…ç½®ç±»å‹',
    category VARCHAR(50) NOT NULL COMMENT 'é…ç½®åˆ†ç±»',
    description TEXT DEFAULT NULL COMMENT 'é…ç½®æè¿°',

    is_system BOOLEAN DEFAULT FALSE COMMENT 'æ˜¯å¦ç³»ç»Ÿé…ç½®',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'æ›´æ–°æ—¶é—´',
    created_by VARCHAR(50) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
    updated_by VARCHAR(50) DEFAULT NULL COMMENT 'æ›´æ–°äºº',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_config_key (config_key),
    INDEX idx_config_category (category),
    INDEX idx_config_system (is_system)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç³»ç»Ÿé…ç½®è¡¨';
```

### 2.8 æ•°æ®å¯¼å…¥ä»»åŠ¡è¡¨ (data_import_tasks)

```sql
CREATE TABLE data_import_tasks (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'å¯¼å…¥ä»»åŠ¡ID',
    import_id VARCHAR(50) NOT NULL COMMENT 'å¯¼å…¥ä»»åŠ¡å”¯ä¸€æ ‡è¯†',
    station_id BIGINT UNSIGNED NOT NULL COMMENT 'æ³µç«™ID',
    device_id BIGINT UNSIGNED DEFAULT NULL COMMENT 'è®¾å¤‡IDï¼ˆå¯é€‰ï¼‰',
    
    -- æ–‡ä»¶ä¿¡æ¯
    file_path VARCHAR(500) NOT NULL COMMENT 'æ–‡ä»¶è·¯å¾„',
    file_name VARCHAR(200) NOT NULL COMMENT 'æ–‡ä»¶å',
    file_size BIGINT UNSIGNED NOT NULL COMMENT 'æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰',
    file_hash VARCHAR(64) DEFAULT NULL COMMENT 'æ–‡ä»¶å“ˆå¸Œå€¼',
    
    -- å¯¼å…¥é…ç½®
    import_config JSON NOT NULL COMMENT 'å¯¼å…¥é…ç½®ï¼ˆå­—æ®µæ˜ å°„ã€æ—¶é—´æ ¼å¼ç­‰ï¼‰',
    data_source VARCHAR(50) NOT NULL DEFAULT 'csv' COMMENT 'æ•°æ®æºç±»å‹',
    
    -- è¿›åº¦ç»Ÿè®¡
    total_records BIGINT UNSIGNED DEFAULT 0 COMMENT 'æ€»è®°å½•æ•°',
    processed_records BIGINT UNSIGNED DEFAULT 0 COMMENT 'å·²å¤„ç†è®°å½•æ•°',
    successful_records BIGINT UNSIGNED DEFAULT 0 COMMENT 'æˆåŠŸè®°å½•æ•°',
    failed_records BIGINT UNSIGNED DEFAULT 0 COMMENT 'å¤±è´¥è®°å½•æ•°',
    duplicate_records BIGINT UNSIGNED DEFAULT 0 COMMENT 'é‡å¤è®°å½•æ•°',
    
    -- æ€§èƒ½æŒ‡æ ‡
    processing_rate DECIMAL(8,2) DEFAULT NULL COMMENT 'å¤„ç†é€Ÿç‡ï¼ˆè®°å½•/ç§’ï¼‰',
    throughput_mbps DECIMAL(8,2) DEFAULT NULL COMMENT 'ååé‡ï¼ˆMB/sï¼‰',
    
    -- æ—¶é—´ä¿¡æ¯
    start_time TIMESTAMP(3) DEFAULT NULL COMMENT 'å¼€å§‹æ—¶é—´',
    end_time TIMESTAMP(3) DEFAULT NULL COMMENT 'ç»“æŸæ—¶é—´',
    duration_seconds DECIMAL(8,3) DEFAULT NULL COMMENT 'æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰',
    estimated_completion TIMESTAMP(3) DEFAULT NULL COMMENT 'é¢„è®¡å®Œæˆæ—¶é—´',
    
    -- çŠ¶æ€å’Œé”™è¯¯
    status ENUM('pending', 'processing', 'completed', 'failed', 'cancelled') NOT NULL DEFAULT 'pending' COMMENT 'å¯¼å…¥çŠ¶æ€',
    error_message TEXT DEFAULT NULL COMMENT 'é”™è¯¯ä¿¡æ¯',
    error_details JSON DEFAULT NULL COMMENT 'è¯¦ç»†é”™è¯¯ä¿¡æ¯',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) ON UPDATE CURRENT_TIMESTAMP(3) COMMENT 'æ›´æ–°æ—¶é—´',
    created_by VARCHAR(50) DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
    
    PRIMARY KEY (id),
    UNIQUE KEY uk_import_id (import_id),
    INDEX idx_import_station_id (station_id),
    INDEX idx_import_device_id (device_id),
    INDEX idx_import_status (status),
    INDEX idx_import_start_time (start_time),
    INDEX idx_import_file_hash (file_hash),
    
    CONSTRAINT fk_import_station_id FOREIGN KEY (station_id) REFERENCES stations(id) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT fk_import_device_id FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ•°æ®å¯¼å…¥ä»»åŠ¡è¡¨';
```

### 2.9 ç³»ç»Ÿæ—¥å¿—è¡¨ (system_logs)

```sql
CREATE TABLE system_logs (
    id BIGINT UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'æ—¥å¿—ID',
    log_level ENUM('DEBUG', 'INFO', 'WARNING', 'ERROR', 'CRITICAL') NOT NULL COMMENT 'æ—¥å¿—çº§åˆ«',
    component VARCHAR(50) NOT NULL COMMENT 'ç»„ä»¶åç§°',
    operation VARCHAR(100) NOT NULL COMMENT 'æ“ä½œåç§°',
    message TEXT NOT NULL COMMENT 'æ—¥å¿—æ¶ˆæ¯',
    details JSON DEFAULT NULL COMMENT 'è¯¦ç»†ä¿¡æ¯',
    
    -- å…³è”ä¿¡æ¯
    station_id BIGINT UNSIGNED DEFAULT NULL COMMENT 'å…³è”æ³µç«™ID',
    device_id BIGINT UNSIGNED DEFAULT NULL COMMENT 'å…³è”è®¾å¤‡ID',
    user_id VARCHAR(50) DEFAULT NULL COMMENT 'ç”¨æˆ·ID',
    session_id VARCHAR(100) DEFAULT NULL COMMENT 'ä¼šè¯ID',
    request_id VARCHAR(100) DEFAULT NULL COMMENT 'è¯·æ±‚ID',
    
    -- æ€§èƒ½ä¿¡æ¯
    execution_time_ms DECIMAL(10,3) DEFAULT NULL COMMENT 'æ‰§è¡Œæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰',
    memory_usage_mb DECIMAL(8,2) DEFAULT NULL COMMENT 'å†…å­˜ä½¿ç”¨ï¼ˆMBï¼‰',
    
    -- ç½‘ç»œä¿¡æ¯
    ip_address VARCHAR(45) DEFAULT NULL COMMENT 'IPåœ°å€',
    user_agent TEXT DEFAULT NULL COMMENT 'ç”¨æˆ·ä»£ç†',
    
    created_at TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP(3) COMMENT 'åˆ›å»ºæ—¶é—´',
    
    PRIMARY KEY (id),
    INDEX idx_logs_level (log_level),
    INDEX idx_logs_component (component),
    INDEX idx_logs_operation (operation),
    INDEX idx_logs_created_at (created_at),
    INDEX idx_logs_station_id (station_id),
    INDEX idx_logs_device_id (device_id),
    INDEX idx_logs_user_id (user_id),
    INDEX idx_logs_request_id (request_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ç³»ç»Ÿæ—¥å¿—è¡¨'
PARTITION BY RANGE (UNIX_TIMESTAMP(created_at)) (
    PARTITION p_logs_202501 VALUES LESS THAN (UNIX_TIMESTAMP('2025-02-01 00:00:00')),
    PARTITION p_logs_202502 VALUES LESS THAN (UNIX_TIMESTAMP('2025-03-01 00:00:00')),
    PARTITION p_logs_202503 VALUES LESS THAN (UNIX_TIMESTAMP('2025-04-01 00:00:00')),
    PARTITION p_logs_202504 VALUES LESS THAN (UNIX_TIMESTAMP('2025-05-01 00:00:00')),
    PARTITION p_logs_202505 VALUES LESS THAN (UNIX_TIMESTAMP('2025-06-01 00:00:00')),
    PARTITION p_logs_202506 VALUES LESS THAN (UNIX_TIMESTAMP('2025-07-01 00:00:00')),
    PARTITION p_logs_future VALUES LESS THAN MAXVALUE
);
```

## 3. è§†å›¾è®¾è®¡

### 3.1 è®¾å¤‡è¿è¡ŒçŠ¶æ€è§†å›¾

```sql
CREATE VIEW v_device_status AS
SELECT 
    d.id AS device_id,
    d.device_name,
    d.device_code,
    d.device_type,
    s.station_name,
    s.station_code,
    d.status AS device_status,
    d.rated_power,
    d.rated_flow,
    d.rated_head,
    -- æœ€æ–°è¿è¡Œæ•°æ®
    latest_data.latest_time,
    latest_data.active_power,
    latest_data.frequency,
    latest_data.efficiency,
    -- ç‰¹æ€§æ›²çº¿ä¿¡æ¯
    curve_info.curve_count,
    curve_info.best_r_squared,
    curve_info.latest_fitting_date
FROM devices d
INNER JOIN stations s ON d.station_id = s.id
LEFT JOIN (
    SELECT 
        device_id,
        MAX(data_time) AS latest_time,
        MAX(CASE WHEN parameter_type = 'active_power' THEN data_value END) AS active_power,
        MAX(CASE WHEN parameter_type = 'frequency' THEN data_value END) AS frequency,
        MAX(CASE WHEN parameter_type = 'efficiency' THEN data_value END) AS efficiency
    FROM operation_data 
    WHERE data_time >= DATE_SUB(NOW(), INTERVAL 1 HOUR)
    GROUP BY device_id
) latest_data ON d.id = latest_data.device_id
LEFT JOIN (
    SELECT 
        device_id,
        COUNT(*) AS curve_count,
        MAX(r_squared) AS best_r_squared,
        MAX(fitting_date) AS latest_fitting_date
    FROM characteristic_curves 
    WHERE is_active = TRUE
    GROUP BY device_id
) curve_info ON d.id = curve_info.device_id;
```

### 3.2 è¿è¡Œæ•ˆç‡ç»Ÿè®¡è§†å›¾

```sql
CREATE VIEW v_efficiency_statistics AS
SELECT 
    s.id AS station_id,
    s.station_name,
    d.id AS device_id,
    d.device_name,
    DATE(od.data_time) AS date,
    AVG(CASE WHEN od.parameter_type = 'efficiency' THEN od.data_value END) AS avg_efficiency,
    MAX(CASE WHEN od.parameter_type = 'efficiency' THEN od.data_value END) AS max_efficiency,
    MIN(CASE WHEN od.parameter_type = 'efficiency' THEN od.data_value END) AS min_efficiency,
    AVG(CASE WHEN od.parameter_type = 'active_power' THEN od.data_value END) AS avg_power,
    AVG(CASE WHEN od.parameter_type = 'flow_rate' THEN od.data_value END) AS avg_flow,
    COUNT(*) AS data_points
FROM operation_data od
INNER JOIN devices d ON od.device_id = d.id
INNER JOIN stations s ON od.station_id = s.id
WHERE od.parameter_type IN ('efficiency', 'active_power', 'flow_rate')
    AND od.data_time >= DATE_SUB(CURDATE(), INTERVAL 30 DAY)
GROUP BY s.id, s.station_name, d.id, d.device_name, DATE(od.data_time);
```

## 4. å­˜å‚¨è¿‡ç¨‹

### 4.1 æ‰¹é‡æ’å…¥è¿è¡Œæ•°æ®å­˜å‚¨è¿‡ç¨‹

```sql
DELIMITER //

CREATE PROCEDURE sp_batch_insert_operation_data(
    IN p_station_id BIGINT UNSIGNED,
    IN p_device_id BIGINT UNSIGNED,
    IN p_data JSON
)
BEGIN
    DECLARE v_error_count INT DEFAULT 0;
    DECLARE v_success_count INT DEFAULT 0;
    DECLARE v_duplicate_count INT DEFAULT 0;
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;
    
    START TRANSACTION;
    
    -- åˆ›å»ºä¸´æ—¶è¡¨
    CREATE TEMPORARY TABLE temp_operation_data (
        tag_name VARCHAR(200),
        data_time TIMESTAMP(3),
        data_value DECIMAL(15,6),
        parameter_type VARCHAR(50),
        unit VARCHAR(20)
    );
    
    -- æ’å…¥JSONæ•°æ®åˆ°ä¸´æ—¶è¡¨
    INSERT INTO temp_operation_data (tag_name, data_time, data_value, parameter_type, unit)
    SELECT 
        JSON_UNQUOTE(JSON_EXTRACT(value, '$.tag_name')),
        STR_TO_DATE(JSON_UNQUOTE(JSON_EXTRACT(value, '$.data_time')), '%Y-%m-%d %H:%i:%s.%f'),
        CAST(JSON_UNQUOTE(JSON_EXTRACT(value, '$.data_value')) AS DECIMAL(15,6)),
        JSON_UNQUOTE(JSON_EXTRACT(value, '$.parameter_type')),
        JSON_UNQUOTE(JSON_EXTRACT(value, '$.unit'))
    FROM JSON_TABLE(p_data, '$[*]' COLUMNS (
        value JSON PATH '$'
    )) AS jt;
    
    -- æ‰¹é‡æ’å…¥ï¼Œå¿½ç•¥é‡å¤æ•°æ®
    INSERT IGNORE INTO operation_data (
        station_id, device_id, tag_name, data_time, data_value, parameter_type, unit
    )
    SELECT 
        p_station_id,
        p_device_id,
        tag_name,
        data_time,
        data_value,
        parameter_type,
        unit
    FROM temp_operation_data
    WHERE data_time IS NOT NULL AND data_value IS NOT NULL;
    
    -- è·å–ç»Ÿè®¡ä¿¡æ¯
    SELECT ROW_COUNT() AS inserted_count;
    
    DROP TEMPORARY TABLE temp_operation_data;
    
    COMMIT;
END //

DELIMITER ;
```

### 4.2 æ•°æ®è´¨é‡æ£€æŸ¥å­˜å‚¨è¿‡ç¨‹

```sql
DELIMITER //

CREATE PROCEDURE sp_data_quality_check(
    IN p_station_id BIGINT UNSIGNED,
    IN p_device_id BIGINT UNSIGNED,
    IN p_start_time TIMESTAMP(3),
    IN p_end_time TIMESTAMP(3)
)
BEGIN
    DECLARE v_total_points BIGINT DEFAULT 0;
    DECLARE v_missing_points BIGINT DEFAULT 0;
    DECLARE v_outlier_points BIGINT DEFAULT 0;
    DECLARE v_duplicate_points BIGINT DEFAULT 0;
    
    -- æ€»æ•°æ®ç‚¹æ•°
    SELECT COUNT(*) INTO v_total_points
    FROM operation_data
    WHERE station_id = p_station_id
        AND device_id = p_device_id
        AND data_time BETWEEN p_start_time AND p_end_time;
    
    -- æ£€æŸ¥ç¼ºå¤±æ•°æ®ï¼ˆåŸºäºé¢„æœŸçš„1ç§’é—´éš”ï¼‰
    SELECT 
        TIMESTAMPDIFF(SECOND, p_start_time, p_end_time) - COUNT(DISTINCT data_time) INTO v_missing_points
    FROM operation_data
    WHERE station_id = p_station_id
        AND device_id = p_device_id
        AND data_time BETWEEN p_start_time AND p_end_time;
    
    -- æ£€æŸ¥å¼‚å¸¸å€¼ï¼ˆä½¿ç”¨3ÏƒåŸåˆ™ï¼‰
    SELECT COUNT(*) INTO v_outlier_points
    FROM operation_data od1
    WHERE station_id = p_station_id
        AND device_id = p_device_id
        AND data_time BETWEEN p_start_time AND p_end_time
        AND ABS(data_value - (
            SELECT AVG(data_value)
            FROM operation_data od2
            WHERE od2.station_id = od1.station_id
                AND od2.device_id = od1.device_id
                AND od2.parameter_type = od1.parameter_type
                AND od2.data_time BETWEEN p_start_time AND p_end_time
        )) > 3 * (
            SELECT STDDEV(data_value)
            FROM operation_data od3
            WHERE od3.station_id = od1.station_id
                AND od3.device_id = od1.device_id
                AND od3.parameter_type = od1.parameter_type
                AND od3.data_time BETWEEN p_start_time AND p_end_time
        );
    
    -- æ£€æŸ¥é‡å¤æ•°æ®
    SELECT COUNT(*) - COUNT(DISTINCT station_id, device_id, tag_name, data_time) INTO v_duplicate_points
    FROM operation_data
    WHERE station_id = p_station_id
        AND device_id = p_device_id
        AND data_time BETWEEN p_start_time AND p_end_time;
    
    -- è¿”å›è´¨é‡æŠ¥å‘Š
    SELECT 
        v_total_points AS total_points,
        v_missing_points AS missing_points,
        v_outlier_points AS outlier_points,
        v_duplicate_points AS duplicate_points,
        ROUND((v_total_points - v_missing_points - v_outlier_points) / v_total_points * 100, 2) AS quality_score;
END //

DELIMITER ;
```

## 5. è§¦å‘å™¨

### 5.1 è®¾å¤‡çŠ¶æ€å˜æ›´æ—¥å¿—è§¦å‘å™¨

```sql
DELIMITER //

CREATE TRIGGER tr_devices_status_change
AFTER UPDATE ON devices
FOR EACH ROW
BEGIN
    IF OLD.status != NEW.status THEN
        INSERT INTO system_logs (
            log_level, component, operation, message, details,
            station_id, device_id, created_at
        ) VALUES (
            'INFO',
            'device_management',
            'status_change',
            CONCAT('è®¾å¤‡çŠ¶æ€å˜æ›´: ', OLD.device_name, ' ä» ', OLD.status, ' å˜æ›´ä¸º ', NEW.status),
            JSON_OBJECT(
                'device_id', NEW.id,
                'device_name', NEW.device_name,
                'old_status', OLD.status,
                'new_status', NEW.status,
                'updated_by', NEW.updated_by
            ),
            NEW.station_id,
            NEW.id,
            NOW(3)
        );
    END IF;
END //

DELIMITER ;
```

### 5.2 è¿è¡Œæ•°æ®å¼‚å¸¸å€¼æ£€æµ‹è§¦å‘å™¨

```sql
DELIMITER //

CREATE TRIGGER tr_operation_data_anomaly_detection
AFTER INSERT ON operation_data
FOR EACH ROW
BEGIN
    DECLARE v_avg_value DECIMAL(15,6);
    DECLARE v_std_value DECIMAL(15,6);
    DECLARE v_threshold DECIMAL(15,6);
    
    -- è®¡ç®—æœ€è¿‘24å°æ—¶åŒç±»å‹å‚æ•°çš„å¹³å‡å€¼å’Œæ ‡å‡†å·®
    SELECT AVG(data_value), STDDEV(data_value)
    INTO v_avg_value, v_std_value
    FROM operation_data
    WHERE device_id = NEW.device_id
        AND parameter_type = NEW.parameter_type
        AND data_time >= DATE_SUB(NEW.data_time, INTERVAL 24 HOUR)
        AND data_time < NEW.data_time;
    
    -- å¦‚æœæœ‰è¶³å¤Ÿçš„å†å²æ•°æ®è¿›è¡Œæ¯”è¾ƒ
    IF v_avg_value IS NOT NULL AND v_std_value IS NOT NULL AND v_std_value > 0 THEN
        SET v_threshold = 3 * v_std_value;
        
        -- æ£€æŸ¥æ˜¯å¦ä¸ºå¼‚å¸¸å€¼ï¼ˆ3ÏƒåŸåˆ™ï¼‰
        IF ABS(NEW.data_value - v_avg_value) > v_threshold THEN
            INSERT INTO system_logs (
                log_level, component, operation, message, details,
                station_id, device_id, created_at
            ) VALUES (
                'WARNING',
                'data_quality',
                'anomaly_detection',
                CONCAT('æ£€æµ‹åˆ°å¼‚å¸¸æ•°æ®å€¼: ', NEW.parameter_type, ' = ', NEW.data_value),
                JSON_OBJECT(
                    'data_id', NEW.id,
                    'device_id', NEW.device_id,
                    'parameter_type', NEW.parameter_type,
                    'data_value', NEW.data_value,
                    'expected_range', JSON_OBJECT(
                        'mean', v_avg_value,
                        'std', v_std_value,
                        'threshold', v_threshold
                    ),
                    'deviation', ABS(NEW.data_value - v_avg_value)
                ),
                NEW.station_id,
                NEW.device_id,
                NOW(3)
            );
        END IF;
    END IF;
END //

DELIMITER ;
```

## 6. ç´¢å¼•ä¼˜åŒ–ç­–ç•¥

### 6.1 å¤åˆç´¢å¼•è®¾è®¡åŸåˆ™

1. **æŸ¥è¯¢é¢‘ç‡ä¼˜å…ˆ**: æœ€å¸¸ç”¨çš„æŸ¥è¯¢æ¡ä»¶æ”¾åœ¨ç´¢å¼•å‰é¢
2. **é€‰æ‹©æ€§ä¼˜å…ˆ**: é€‰æ‹©æ€§é«˜çš„å­—æ®µæ”¾åœ¨å‰é¢
3. **èŒƒå›´æŸ¥è¯¢æœ€å**: èŒƒå›´æŸ¥è¯¢å­—æ®µæ”¾åœ¨ç´¢å¼•æœ€å

### 6.2 å…³é”®ç´¢å¼•

```sql
-- è¿è¡Œæ•°æ®è¡¨çš„å…³é”®ç´¢å¼•
CREATE INDEX idx_operation_data_device_time_param ON operation_data(device_id, data_time, parameter_type);
CREATE INDEX idx_operation_data_station_time ON operation_data(station_id, data_time);
CREATE INDEX idx_operation_data_time_param ON operation_data(data_time, parameter_type);

-- ç‰¹æ€§æ›²çº¿è¡¨çš„å…³é”®ç´¢å¼•
CREATE INDEX idx_curves_device_type_active ON characteristic_curves(device_id, curve_type, is_active);
CREATE INDEX idx_curves_r_squared_desc ON characteristic_curves(r_squared DESC);

-- ä¼˜åŒ–ç»“æœè¡¨çš„å…³é”®ç´¢å¼•
CREATE INDEX idx_optimization_station_time ON optimization_results(station_id, optimization_start_time);
CREATE INDEX idx_optimization_quality_desc ON optimization_results(solution_quality_score DESC);
```

## 7. åˆ†åŒºç­–ç•¥

### 7.1 æ—¶é—´åˆ†åŒº

è¿è¡Œæ•°æ®è¡¨å’Œæ—¥å¿—è¡¨é‡‡ç”¨æŒ‰æœˆåˆ†åŒºç­–ç•¥ï¼š

```sql
-- è‡ªåŠ¨åˆ›å»ºæ–°åˆ†åŒºçš„å­˜å‚¨è¿‡ç¨‹
DELIMITER //

CREATE PROCEDURE sp_create_monthly_partitions(
    IN p_table_name VARCHAR(64),
    IN p_months_ahead INT
)
BEGIN
    DECLARE v_partition_name VARCHAR(64);
    DECLARE v_partition_value VARCHAR(64);
    DECLARE v_current_date DATE;
    DECLARE v_counter INT DEFAULT 0;
    
    SET v_current_date = LAST_DAY(CURDATE()) + INTERVAL 1 DAY;
    
    WHILE v_counter < p_months_ahead DO
        SET v_partition_name = CONCAT('p', DATE_FORMAT(v_current_date, '%Y%m'));
        SET v_partition_value = UNIX_TIMESTAMP(v_current_date + INTERVAL 1 MONTH);
        
        SET @sql = CONCAT(
            'ALTER TABLE ', p_table_name,
            ' ADD PARTITION (PARTITION ', v_partition_name,
            ' VALUES LESS THAN (', v_partition_value, '))'
        );
        
        PREPARE stmt FROM @sql;
        EXECUTE stmt;
        DEALLOCATE PREPARE stmt;
        
        SET v_current_date = v_current_date + INTERVAL 1 MONTH;
        SET v_counter = v_counter + 1;
    END WHILE;
END //

DELIMITER ;
```

### 7.2 åˆ†åŒºç»´æŠ¤

```sql
-- åˆ é™¤æ—§åˆ†åŒºçš„å­˜å‚¨è¿‡ç¨‹
DELIMITER //

CREATE PROCEDURE sp_drop_old_partitions(
    IN p_table_name VARCHAR(64),
    IN p_keep_months INT
)
BEGIN
    DECLARE v_partition_name VARCHAR(64);
    DECLARE v_cutoff_date DATE;
    DECLARE done INT DEFAULT FALSE;
    DECLARE partition_cursor CURSOR FOR
        SELECT PARTITION_NAME
        FROM INFORMATION_SCHEMA.PARTITIONS
        WHERE TABLE_SCHEMA = DATABASE()
            AND TABLE_NAME = p_table_name
            AND PARTITION_NAME IS NOT NULL
            AND PARTITION_NAME != 'p_future'
            AND PARTITION_NAME < CONCAT('p', DATE_FORMAT(DATE_SUB(CURDATE(), INTERVAL p_keep_months MONTH), '%Y%m'));
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    OPEN partition_cursor;
    
    read_loop: LOOP
        FETCH partition_cursor INTO v_partition_name;
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        SET @sql = CONCAT('ALTER TABLE ', p_table_name, ' DROP PARTITION ', v_partition_name);
        PREPARE stmt FROM @sql;
        EXECUTE stmt;
        DEALLOCATE PREPARE stmt;
    END LOOP;
    
    CLOSE partition_cursor;
END //

DELIMITER ;
```

## 8. æ€§èƒ½ä¼˜åŒ–é…ç½®

### 8.1 MySQLé…ç½®ä¼˜åŒ–

```ini
# my.cnf å…³é”®é…ç½®
[mysqld]
# åŸºç¡€é…ç½®
default-storage-engine = InnoDB
default-table-type = InnoDB
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci

# å†…å­˜é…ç½®
innodb_buffer_pool_size = 4G
innodb_log_file_size = 512M
innodb_log_buffer_size = 64M
innodb_flush_log_at_trx_commit = 2
innodb_flush_method = O_DIRECT

# å¹¶å‘é…ç½®
innodb_thread_concurrency = 0
innodb_read_io_threads = 8
innodb_write_io_threads = 8
max_connections = 500
thread_cache_size = 50

# æŸ¥è¯¢ç¼“å­˜
query_cache_type = 1
query_cache_size = 256M
query_cache_limit = 2M

# ä¸´æ—¶è¡¨
tmp_table_size = 256M
max_heap_table_size = 256M

# äºŒè¿›åˆ¶æ—¥å¿—
log-bin = mysql-bin
binlog_format = ROW
expire_logs_days = 7

# æ…¢æŸ¥è¯¢æ—¥å¿—
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1
```

### 8.2 æ‰¹é‡æ’å…¥ä¼˜åŒ–

```sql
-- æ‰¹é‡æ’å…¥ä¼˜åŒ–è®¾ç½®
SET autocommit = 0;
SET unique_checks = 0;
SET foreign_key_checks = 0;

-- æ‰§è¡Œæ‰¹é‡æ’å…¥
INSERT INTO operation_data (station_id, device_id, tag_name, data_time, data_value, parameter_type) VALUES
(1, 1, 'tag1', '2025-01-28 10:00:00.000', 45.5, 'active_power'),
(1, 1, 'tag2', '2025-01-28 10:00:01.000', 46.2, 'active_power'),
-- ... æ›´å¤šæ•°æ®
;

-- æ¢å¤è®¾ç½®
SET foreign_key_checks = 1;
SET unique_checks = 1;
COMMIT;
SET autocommit = 1;
```

## 9. æ•°æ®å¤‡ä»½ä¸æ¢å¤

### 9.1 å¤‡ä»½ç­–ç•¥

```bash
#!/bin/bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬

DB_NAME="pump_station_optimization"
BACKUP_DIR="/backup/mysql"
DATE=$(date +%Y%m%d_%H%M%S)

# å…¨é‡å¤‡ä»½
mysqldump --single-transaction --routines --triggers \
    --master-data=2 --flush-logs \
    --databases $DB_NAME > $BACKUP_DIR/full_backup_$DATE.sql

# å‹ç¼©å¤‡ä»½æ–‡ä»¶
gzip $BACKUP_DIR/full_backup_$DATE.sql

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "full_backup_*.sql.gz" -mtime +7 -delete

# å¢é‡å¤‡ä»½ï¼ˆäºŒè¿›åˆ¶æ—¥å¿—ï¼‰
mysqlbinlog --start-datetime="$(date -d '1 day ago' '+%Y-%m-%d %H:%M:%S')" \
    /var/lib/mysql/mysql-bin.* > $BACKUP_DIR/incremental_backup_$DATE.sql
```

### 9.2 æ¢å¤è„šæœ¬

```bash
#!/bin/bash
# æ•°æ®åº“æ¢å¤è„šæœ¬

BACKUP_FILE=$1
DB_NAME="pump_station_optimization"

if [ -z "$BACKUP_FILE" ]; then
    echo "Usage: $0 <backup_file>"
    exit 1
fi

# åœæ­¢åº”ç”¨æœåŠ¡
systemctl stop pump-station-api

# æ¢å¤æ•°æ®åº“
if [[ $BACKUP_FILE == *.gz ]]; then
    gunzip -c $BACKUP_FILE | mysql $DB_NAME
else
    mysql $DB_NAME < $BACKUP_FILE
fi

# é‡å¯åº”ç”¨æœåŠ¡
systemctl start pump-station-api

echo "Database restored from $BACKUP_FILE"
```

## 10. ç›‘æ§ä¸ç»´æŠ¤

### 10.1 æ€§èƒ½ç›‘æ§æŸ¥è¯¢

```sql
-- æŸ¥çœ‹è¡¨å¤§å°å’Œè¡Œæ•°
SELECT 
    TABLE_NAME,
    ROUND(((DATA_LENGTH + INDEX_LENGTH) / 1024 / 1024), 2) AS 'Size (MB)',
    TABLE_ROWS
FROM information_schema.TABLES
WHERE TABLE_SCHEMA = 'pump_station_optimization'
ORDER BY (DATA_LENGTH + INDEX_LENGTH) DESC;

-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨æƒ…å†µ
SELECT 
    TABLE_NAME,
    INDEX_NAME,
    CARDINALITY,
    ROUND(CARDINALITY / TABLE_ROWS * 100, 2) AS 'Selectivity %'
FROM information_schema.STATISTICS s
JOIN information_schema.TABLES t ON s.TABLE_NAME = t.TABLE_NAME
WHERE s.TABLE_SCHEMA = 'pump_station_optimization'
    AND t.TABLE_SCHEMA = 'pump_station_optimization'
ORDER BY TABLE_NAME, INDEX_NAME;

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SELECT 
    query_time,
    lock_time,
    rows_sent,
    rows_examined,
    sql_text
FROM mysql.slow_log
WHERE start_time >= DATE_SUB(NOW(), INTERVAL 1 DAY)
ORDER BY query_time DESC
LIMIT 10;
```

### 10.2 ç»´æŠ¤ä»»åŠ¡

```sql
-- å®šæœŸä¼˜åŒ–è¡¨
OPTIMIZE TABLE operation_data;
OPTIMIZE TABLE characteristic_curves;
OPTIMIZE TABLE optimization_results;

-- æ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
ANALYZE TABLE operation_data;
ANALYZE TABLE characteristic_curves;
ANALYZE TABLE optimization_results;

-- æ£€æŸ¥è¡¨å®Œæ•´æ€§
CHECK TABLE operation_data;
CHECK TABLE characteristic_curves;
CHECK TABLE optimization_results;
```



---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-28  
**ç»´æŠ¤å›¢é˜Ÿ**: æ³µç«™ä¼˜åŒ–ç³»ç»Ÿå¼€å‘å›¢é˜Ÿ  
**å®¡æ ¸çŠ¶æ€**: å¾…å®¡æ ¸