# 水泵工程参数计算规范

## 1. 概述

本文档定义基于现有监测数据计算水泵特性曲线拟合所需工程参数的方法，包括单泵瞬时流量、扬程、效率等关键参数的计算规范。

## 2. 数据源分析

### 2.1 可用数据类型

基于 `data_mapping.json` 配置，二期设备可用数据包括：

**供水泵房数据：**
- 总管数据：压力、瞬时流量、累计流量
- 单泵电气数据：频率、电压(ABC三相)、电流(ABC三相)、有功功率、功率因数、电度
- 设备类型：变频泵(1-6#)

**取水泵房数据：**
- 总管数据：瞬时流量、累计流量
- 单泵电气数据：频率(2#、5#变频泵)、电压电流功率等
- 设备类型：软启动泵(1#、3#、4#)、变频泵(2#、5#)

## 3. 工程参数计算方法

### 3.1 单泵瞬时流量计算

#### 3.1.1 供水泵房单泵流量

**计算原理：**
基于总管流量和各泵运行状态分配计算单泵流量。

**计算公式：**
```
Q_pump_i = Q_total × (P_pump_i / P_total_running) × η_distribution
```

**参数说明：**
- `Q_pump_i`：第i台泵的瞬时流量 (m³/h)
- `Q_total`：总管瞬时流量 (m³/h)
- `P_pump_i`：第i台泵的有功功率 (kW)
- `P_total_running`：所有运行泵的功率总和 (kW)
- `η_distribution`：流量分配修正系数 (0.95-1.05)

**实现步骤：**
1. 读取总管瞬时流量数据
2. 识别运行中的泵（功率 > 阈值，如5kW）
3. 按功率比例分配总流量
4. 应用分配修正系数

#### 3.1.2 取水泵房单泵流量

**计算方法：**
```
Q_pump_i = Q_total × (f_pump_i / f_rated)^3 × (运行状态系数)
```

**参数说明：**
- `f_pump_i`：第i台泵的运行频率 (Hz)
- `f_rated`：额定频率 (50Hz)
- 运行状态系数：变频泵=1.0，软启动泵根据功率判断

### 3.2 扬程计算

#### 3.2.1 供水泵房扬程

**计算公式：**
```
H = (P_outlet - P_inlet) / (ρ × g) + H_velocity + H_loss
```

**参数说明：**
- `H`：泵扬程 (m)
- `P_outlet`：出口压力 (Pa)，来自总管压力数据
- `P_inlet`：进口压力 (Pa)，设定为大气压或实测值
- `ρ`：水密度 (1000 kg/m³)
- `g`：重力加速度 (9.81 m/s²)
- `H_velocity`：速度扬程 (m)
- `H_loss`：管路损失 (m)

**简化计算：**
```
H ≈ P_outlet / (ρ × g) + H_static
```
其中 `H_static` 为静扬程，根据泵房设计确定。

### 3.3 泵效率计算

**计算公式：**
```
η = (ρ × g × Q × H) / (P_shaft × 1000) × 100%
```

**参数说明：**
- `η`：泵效率 (%)
- `Q`：流量 (m³/s)
- `H`：扬程 (m)
- `P_shaft`：轴功率 (kW)，通过电功率和电机效率计算

**轴功率计算：**
```
P_shaft = P_electric × η_motor × η_inverter
```
- `η_motor`：电机效率 (0.90-0.95)
- `η_inverter`：变频器效率 (0.95-0.98)

### 3.4 比转速计算

**计算公式：**
```
ns = n × √Q / H^(3/4)
```

**参数说明：**
- `ns`：比转速
- `n`：转速 (r/min)，通过频率计算：n = f × 60 / p（p为极对数）
- `Q`：流量 (m³/s)
- `H`：扬程 (m)

## 4. 数据质量控制

### 4.1 数据有效性检查

**流量数据：**
- 范围检查：0 ≤ Q ≤ Q_max_design
- 变化率检查：|ΔQ/Δt| ≤ 阈值
- 一致性检查：单泵流量之和 ≈ 总管流量

**压力数据：**
- 范围检查：0 ≤ P ≤ P_max_design
- 物理合理性：出口压力 > 进口压力

**功率数据：**
- 范围检查：0 ≤ P ≤ P_rated × 1.1
- 功率因数检查：0.7 ≤ cosφ ≤ 1.0

### 4.2 异常值处理

**识别方法：**
- 3σ准则
- 四分位数法
- 时间序列异常检测

**处理策略：**
- 轻微异常：线性插值
- 严重异常：标记为缺失值
- 连续异常：使用历史同期数据

## 5. 计算实现规范

### 5.1 时间对齐

**对齐策略：**
- 统一时间戳格式：ISO 8601
- 时间窗口：1分钟
- 插值方法：线性插值

### 5.2 计算频率

**实时计算：**
- 数据更新频率：1分钟
- 计算触发：新数据到达时
- 结果缓存：5分钟

**批量计算：**
- 历史数据重算：按日批处理
- 参数优化：按月重新标定

### 5.3 结果存储

**计算结果表结构：**
```sql
CREATE TABLE calculated_parameters (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    station_id VARCHAR(50) NOT NULL,
    device_id VARCHAR(50) NOT NULL,
    data_time TIMESTAMP NOT NULL,
    flow_rate DECIMAL(10,3),           -- 瞬时流量 m³/h
    head DECIMAL(8,2),                 -- 扬程 m
    efficiency DECIMAL(5,2),           -- 效率 %
    specific_speed DECIMAL(8,2),       -- 比转速
    shaft_power DECIMAL(8,3),          -- 轴功率 kW
    calculation_method VARCHAR(50),     -- 计算方法
    quality_flag TINYINT,              -- 质量标记
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 6. 应用场景

### 6.1 特性曲线拟合

**Q-H曲线：**
- 数据点：(流量, 扬程)
- 拟合方法：二次多项式
- 应用范围：0.5Q_rated ~ 1.2Q_rated

**Q-η曲线：**
- 数据点：(流量, 效率)
- 拟合方法：三次多项式
- 最优工况点识别

**Q-P曲线：**
- 数据点：(流量, 轴功率)
- 拟合方法：二次多项式
- 功率预测

### 6.2 运行优化

**最优调度：**
- 基于效率曲线选择运行泵组
- 变频调节优化
- 能耗最小化

**故障诊断：**
- 效率下降趋势分析
- 特性曲线偏移检测
- 异常工况识别

## 7. 质量保证

### 7.1 计算精度要求

- 流量计算误差：≤ 5%
- 扬程计算误差：≤ 3%
- 效率计算误差：≤ 2%

### 7.2 验证方法

**对比验证：**
- 与设计参数对比
- 与厂家试验数据对比
- 与现场测试数据对比

**一致性验证：**
- 能量平衡检查
- 物理约束检查
- 趋势合理性检查

---

*本规范基于二期设备实际配置制定，确保计算结果可用于水泵特性曲线拟合和运行优化分析。*