---
alwaysApply: true
description: 记忆规则（自动记忆：长期事实与每次错误修复/代码修改；含安全与冲突处理）
---
# 记忆规则（自动）

## 目标
- 降低沟通成本、沉淀稳定事实；自动记录错误修复/代码修改要点，避免反复修改。

## 自动创建与更新
- 自动创建：以下信息默认写入记忆（无需用户额外指令）：
  - 长期事实：库名、表清单、导入与对齐策略、禁区、目录约定。
  - 操作决定：参数阈值、并发/批量配置、开关位默认值。
  - 每次变更：错误修复、代码修改、规则更新的“结论级要点”。
- 自动更新：当同一主题有变更时，合并为新版本并标注时间；保留最近 N 条历史（N=20，可调）。
- 自动删除：仅在用户明确否认或存在冲突时，移除过时项。

## 结构与质量
- 结构：`title`（简明主题）+ `summary`（1 段话可执行信息）+ `timestamp` + `scope`（受影响目录/模块）。
- JSON 模板：
```json
{"title":"导入参数决定","summary":"station_parallel=2, commit_rows=50k","timestamp":"2025-02-28T02:00:00Z","scope":["app/ingest","configs/app.yaml"]}
```
- 质量：避免冗长与主观判断；记录“最终决定与约束”，附关键参数与范围。

## 安全与隐私
- 禁止存储敏感信息（密码、密钥、完整连接串）；只保存必要索引信息。
- 对潜在敏感片段先做打码或抽象（如“DB 密码：***”）。

## 冲突与一致性
- 新信息与旧记忆冲突：以最新明确表述为准；保留变更时间与来源。
- 规则优先级：项目规则文件 > 记忆条目。

## 回溯与使用
- 回答时引用记忆中的“最终决定”，但关键事实仍需用工具核验。
- 若记忆存在空白或不确定，优先澄清或查证。

## 工具与实现建议
- 记录触发点：
  - 完成“错误修复/代码修改/规则变更”后自动写入摘要；
  - 关键命令执行成功后写入运行参数快照（脱敏）。
- 审计示例：
```json
{"event":"memory.create","title":"规则更新-对齐","scope":[".cursor/rules/02-db-import-align.mdc"],"trace_id":"t-..."}
```
- 存储位置：优先使用安全存储（项目内记忆接口），不落盘敏感信息。