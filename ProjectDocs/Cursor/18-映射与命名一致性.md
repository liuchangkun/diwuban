---
alwaysApply: true
description: 映射与命名一致性（JSON Schema、与 DB 一致性、变更兼容）
---
# 映射与命名一致性

## Schema
- 为 `config/data_mapping.json` 定义 JSON Schema（字段键白名单、文件路径存在性校验、设备/泵型枚举）。
- Schema 文件：`configs/data_mapping_schema.json`，使用 `jsonschema` 校验（见 `scripts/verify_mapping.py`）。

## 一致性
- 站点/设备名必须与 DB 完全一致；不一致时输出差异并中止导入。
- 字段键必须来自 [30] 字典；单位必须在 `field_units` 登记（见 03）。

## 变更兼容
- 提供“重映射表”以过渡历史命名；
- 变更时先 `verify-mapping` 通过，再灰度替换（见 54），失败即回退。

## 校验流程（示例）
1) Schema 验证：文件结构/字段键/路径正则；
2) DB 一致性：`stations/devices` 名称一致；
3) 字段与单位：字段键均在 `field_units` 登记；
4) 路径存在：`data/*.csv` 存在且可读；
5) 失败处置：输出机器可读 JSON 与修复建议（见 48/57），退出码 2/3。

## 片段示例
```json
{"二期供水泵房":{"二期供水泵房1#泵":{"type":["pump"],"pump_type":["variable_frequency"],"frequency":["data/..._频率_反馈.csv"]}}}
```