---
alwaysApply: true
description: 合并与冲突策略（来源优先级、差异阈值、舍入与覆盖）
---
# 合并与冲突策略

## 来源优先级
- 若同一时间同字段来自多文件：
  1) 来自 `data_mapping.json` 标注为主来源的优先；
  2) 否则按同秒最早 `DataTime`；
  3) 完全相同时间则首个载入文件优先（记录日志）。

## 舍入与阈值
- 比较前先做统一舍入（见 32）；
- 阈值示例：相对阈值 1% 或绝对阈值（如功率 10W、压力 1kPa、流量 1 m3/h）；
- 超阈保留优先值，记录 `align.conflict` 事件。

## 覆盖规则
- `JSON_MERGE_PATCH` 仅新增或更新对应键；null 不覆盖有效值。
- 客户端合并需读-改-写并具备幂等重试（对齐 40）。

## 审计
- 记录样本：`field_key`、`value_earliest`、`value_late`、`diff_pct/abs`、`chosen`、`trace_id`；
- 提供按窗口/设备的冲突统计报表。