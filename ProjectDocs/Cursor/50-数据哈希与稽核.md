---
description: 数据哈希与稽核（稳定串定义、碰撞应对、抽样校验与报表）
---
# 数据哈希与稽核

## 稳定串规范化
- 字段顺序：按 `field_key` 字典序排列；
- 数值规约：写入前按 [32] 精度进行舍入，字符串化时不带多余零；
- 时间规约：`standard_time` 格式 `%Y-%m-%d %H:%i:%s`；
- 连接串：`device_id + '_' + standard_time + '_' + JSON_OBJECT(...)`。

## SQL 片段（示例）
```sql
SET @json = JSON_OBJECT('power', 123.45);
SET @stable = CONCAT(123, '_', '2025-02-28 02:00:00', '_', @json);
SELECT MD5(@stable) AS data_hash;
```

## 冲突与异常
- 当相同 `(device_id, standard_time)` 出现不同 `data_hash`：
  - 记录 `event=audit.conflict`，附两个 JSON 片段与差异；
  - 进入隔离区，人工复核（见 223/132）；必要时加盐重新计算并标注版本。

## 抽样与报表
- 按天/设备抽样核验哈希一致性；
- 输出覆盖/新增比例、冲突清单与处理结果报表（与 220/188 对齐）。