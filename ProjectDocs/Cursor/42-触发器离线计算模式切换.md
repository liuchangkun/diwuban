---
description: 触发器/离线计算模式切换（一致性、开关、SOP）
---
# 触发器/离线计算模式切换

## 模式
- 即时（触发器）：INSERT 时即时写 `efficiency/load_rate/health_score`。
- 离线（批处理）：导入后离线回算指定时间段并回写 `data_json`。

## 开关与一致性
- 单点开关：`app.yaml` 中 `compute.mode: trigger|offline`；互斥。
- 切换 SOP：冻结导入→跑完全量回算→一致性校验（随机抽样/指标比对）→解冻导入。

## 回算策略
- 按设备/时间窗口回算；输出对账报表（更新比例/字段覆盖）。

## 风险控制
- 禁止同时双写；切换必须有回退方案与时间窗口选择。