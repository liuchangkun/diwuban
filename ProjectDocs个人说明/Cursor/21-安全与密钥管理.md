______________________________________________________________________

## description: 安全与密钥管理（最小权限、脱敏、来源与审计）

# 安全与密钥管理

## 最小权限

- 生产只授予必要读写；优先只读。
- 对表实行精细化权限（仅 `aligned_data`/`features_device_minute`/`field_units`）。

## 密钥来源与命名

- 使用环境变量或受控 `.env`（示例键）：`DB_HOST/DB_PORT/DB_USER/DB_PASSWORD/DB_NAME`；
- 禁止将 `.env` 提交到仓库；使用 `.env.example` 提供占位键。

## 轮换策略

- 数据库密码按季度/安全事件后轮换；
- 轮换需在变更单中记录：旧/新生效窗口、回滚方法与验证步骤。

## 日志脱敏（与 10 协同）

- 日志/异常不得包含：密码、完整 DSN、Token；
- 统一正则脱敏（见 10 `redaction.patterns`），示例：

```json
{"event":"db.connect.fail","dsn":"mysql://root:***@localhost:3306/..."}
```

## ENV 读取示例（Python）

```python
import os
DB_PASSWORD = os.getenv("DB_PASSWORD")  # 不要打印与落日志
```

## 禁止项

- 禁止在代码/日志/配置中明文密码或完整连接串；
- 禁止通过版本控制传播密钥；
- 禁止为方便调试临时放开“全库 ALL PRIVILEGES”。
