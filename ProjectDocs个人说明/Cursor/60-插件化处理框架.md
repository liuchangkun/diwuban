______________________________________________________________________

## description: 插件化处理框架（处理器/算子接口、生命周期、配置注入、隔离与回退）

# 插件化处理框架

## 目标

- 为 processing/features/ml 提供统一的“可插拔算子”机制，隔离风险、便于灰度与回退。

## 目录与注册

- 放置目录：`app/processing/operators/`、`app/features/operators/`、`app/ml/operators/`。
- 注册表：`operator_registry.py` 以名称→实现映射；白名单加载，禁止动态 eval/import 任意路径。

## 接口约定（签名）

```python
class Operator:
    def __init__(self, config: dict, context: dict | None = None): ...
    def prepare(self) -> None: ...
    def process(self, batch: list[dict]) -> dict: ...  # 返回结果与指标
    def finalize(self) -> dict: ...  # 返回汇总
```

## 上下文注入

- 通过 `context` 注入 `trace_id/job_id/batch_id` 与只读设置；
- 产出内置指标：处理条数、耗时、异常次数。

## 失败降级与回退

- 单算子失败时降级为旁路/跳过并记录；
- 版本回退：注册表同时保留 `prev_version`，可一键切换。

## 测试

- 算子需提供最小样例与基准断言（输入→输出快照），纳入 CI。
