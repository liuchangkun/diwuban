______________________________________________________________________

## description: 事务与锁策略（事务边界、隔离级别、大事务拆分、锁等待与超时）

# 事务与锁策略

## 隔离与边界

- 默认隔离级别：REPEATABLE READ（快照读）；若需 READ COMMITTED 降低锁冲突需评审；
- 明确事务边界：批处理内按 `commit_rows` 拆分小事务，避免长事务占锁。

## 锁类型与使用

- 行锁/间隙锁：避免范围更新导致大量间隙锁；
- `SELECT ... FOR UPDATE` 仅在必要更新前使用，尽量缩小范围与持锁时间。

## 大事务拆分

- 单事务耗时>2s 需自动拆分批次；>5s 触发降并发 50%（参见 40）。

## 锁等待与超时

- `innodb_lock_wait_timeout` 建议 5~15s；超时后记录 SQL 摘要与重试次数（见 44）。

## 监控要点

- 锁等待次数、死锁事件、行锁持有时间；
- 连接池排队时间；配合 23/40 SLO 指标联动降级。
