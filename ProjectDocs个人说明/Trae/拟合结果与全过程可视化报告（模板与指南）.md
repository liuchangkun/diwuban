# 拟合结果与全过程可视化报告（模板与指南）

> 目的：全面、系统、可复现地呈现模型从数据到结果的全过程，包括数据概况、训练流程、超参搜索、评估指标、分维度误差分析、可视化曲线与图表清单、结论与改进建议。

## 1. 实验元信息

- 实验名称：
- 版本/提交：
- 执行时间：
- 运行环境：Python 3.13.6，OS，CPU/GPU，内存
- 数据时间范围：
- 目标变量：
- 主要特征：
- 任务类型：回归/分类/时序预测

## 2. 数据与拆分

- 数据源与口径：采集频率、字段定义、单位、缺失/异常处理策略
- 数据规模：样本数、特征数、时间跨度
- 训练/验证/测试拆分：比例、方法（随机/时间切分/KFold/GroupKFold）
- 目标分布：均值/方差/分位数/是否偏态
- 重要特征的统计：均值/方差/缺失率/异常值占比

## 3. 数据预处理与特征工程

- 清洗：缺失值填充、异常值处理、重复样本、去噪
- 变换：标准化/归一化/对数、Box-Cox、类别编码
- 特征：组合特征、滑窗/滞后特征、滚动统计、节假日/时段/工况派生
- 数据泄露检查：是否有目标提前信息

## 4. 模型与超参

- 模型类型：线性/树模型/集成/深度/时序
- 最终参数：列出关键超参与取值
- 超参搜索：搜索空间、采样策略（Grid/Random/Optuna）、迭代次数、最优试验

## 5. 训练过程可视化

- 学习曲线：训练/验证损失随样本量变化（learning_curve.png）
- 训练曲线：epoch 或迭代步的训练/验证损失（train_val_loss_curve.png）
- 提前停止与最优点：最优轮次、对应指标（early_stopping.png）

## 6. 指标定义与评价口径

- 回归指标：MAE、RMSE、R²、MAPE、SMAPE、MedAE
- 分类指标（若适用）：精确率、召回率、F1、ROC-AUC、PR-AUC、校准误差
- 时序特有（若适用）：sMAPE、MASE、覆盖率(PICP)、区间宽度(PINAW)
- 统一说明：指标越大/越小为优、是否对异常敏感、是否对量纲敏感

## 7. 全局结果汇总（测试集）

- 指标表（例）：
  - MAE：
  - RMSE：
  - R²：
  - MAPE/SMAPE：
  - PICP/PINAW（若提供不确定性区间）：
- 基线对比：简单模型/上一版本/业务规则

## 8. 可视化图表清单（结果）

- 真实值 vs 预测值散点（parity_plot.png），含y=x参考线
- 残差分布直方/核密度（residual_hist_kde.png）
- 残差QQ图（residual_qq.png）
- 误差随时间/样本序列（residual_time_series.png）
- 实际-预测时序叠加（actual_vs_pred_time_series.png）
- 误差分位数剖面图（residual_quantiles.png）
- 分桶误差：按目标取值/流量/频率/负荷区间（bucket_mae_rmse.png）
- 分设备/泵/工况的指标对比（group_metrics.png）
- 特征重要性（feature_importance.png）
- SHAP 总览/依赖图（shap_summary.png、shap_dependence\_<feature>.png）
- 校准曲线与预测区间覆盖（calibration_curve.png、prediction_interval_coverage.png）

## 8.5. 泵/泵组特性曲线与泵站运行可视化（专项）

### 8.5.0 泵专用数据字段与口径定义

- **流量（Q）**：瞬时流量/累计流量，单位 m³/h 或 L/s，采集频率与精度要求
- **扬程（H）**：泵出口压力 - 泵入口压力，单位 m 或 MPa，压力传感器校准
- **转速（n）**：泵轴转速，单位 r/min，编码器或频率反推
- **频率（f）**：变频器输出频率，单位 Hz，与额定频率的比值
- **功率（P）**：轴功率/电功率，单位 kW，功率计测量或电流电压计算
- **效率（η）**：水力效率 = (ρ×g×Q×H) / (1000×P)，百分比
- **电流三相（Ia/Ib/Ic）**：各相电流，单位 A，用于不平衡与过载监控
- **温度**：电机温度/轴承温度/介质温度，单位 ℃
- **振动**：轴向/径向振动幅值，单位 mm/s 或 mm
- **启停状态**：0/1 或 开/关，泵运行状态标识
- **故障码**：设备故障代码，用于故障模式分类
- **水位**：吸水池/压水池水位，单位 m，影响泵工况点
- **NPSH**：汽蚀余量，单位 m，NPSH_available vs NPSH_required

### 8.5.1 泵特性曲线拟合与分析

- 泵头-流量特性曲线（H-Q）：理论曲线 vs 拟合曲线 vs 实测数据点（pump_hq_curve.png）
- 效率-流量特性曲线（η-Q）：最优工作点标识（pump_efficiency_curve.png）
- 功率-流量特性曲线（P-Q）：轴功率随流量变化（pump_power_curve.png）
- NPSH-流量特性曲线：汽蚀余量分析（pump_npsh_curve.png）
- 转速修正特性曲线：不同转速下的H-Q族曲线（pump_speed_curves.png）
- 磨损/老化曲线对比：新泵 vs 运行期 vs 维护后特性变化（pump_aging_comparison.png）

### 8.5.2 泵组运行工况分析

- 泵组并联特性：单泵 vs 双泵 vs 多泵联合运行特性（pump_parallel_curves.png）
- 系统阻力曲线与工作点：管阻曲线 vs 泵特性交点（system_resistance_curve.png）
- 运行工况分布：流量-扬程散点图，标识高效/低效区间（operating_point_distribution.png）
- 变频运行特性：频率-流量-效率三维图（variable_frequency_surface.png）
- 泵切换策略效果：单泵/双泵切换边界与实际切换点（pump_switching_strategy.png）

### 8.5.3 泵站运行状态监控

- 实时运行参数仪表盘：流量/压力/功率/效率/温度多指标（pump_dashboard.png）
- 运行时长与启停频次统计：每台泵的累计运行时间与启停次数（pump_runtime_stats.png）
- 能耗分析：单位流量能耗趋势/日耗电量/泵效对比（energy_consumption_analysis.png）
- 振动与温度监控：轴承温度/振动幅值/频谱分析（pump_condition_monitoring.png）
- 故障预警指标：效率下降/异常振动/温升异常等预警阈值可视化（fault_warning_indicators.png）

### 8.5.4 泵站运行优化分析

- 水位-流量-泵组合最优策略：不同水位下的最优泵组合决策树（optimal_pump_combination.png）
- 需水预测与泵调度：24小时需水预测曲线 vs 泵启停计划（demand_forecast_schedule.png）
- 节能潜力分析：当前运行效率 vs 理论最优效率差值（energy_saving_potential.png）
- 泵站水力损失分解：吸水/压水管路/阀门/接头等各环节损失占比（hydraulic_loss_breakdown.png）
- 运行成本分析：电费/维护费/人工费按时间/工况维度的成本分解（operation_cost_analysis.png）

### 8.5.5 泵性能退化与维护分析

- 性能退化趋势：效率/流量/扬程随时间的长期变化趋势（performance_degradation_trend.png）
- 维护前后对比：大修/小修前后的特性曲线对比（maintenance_before_after.png）
- 备件更换影响：叶轮/密封圈/轴承更换后的性能恢复情况（spare_parts_impact.png）
- 故障模式识别：汽蚀/磨损/不平衡等故障的特征信号模式（fault_pattern_recognition.png）
- 剩余寿命预测：基于性能退化的RUL预测曲线（remaining_useful_life.png）

> 建议将所有图片输出至 reports/images/\<run_id>/ 下，并在文中引用文件名，保证复现性与可追溯。

## 9. 分维度与切片分析

- 时间维度：小时/日/周/工班/季节
- 设备维度：泵/泵组/机组/站点/区域
- 工况维度：频率区间、扬程区间、流量区间、负荷区间
- 状态维度：启停状态、维护/检修标记、告警窗口
- 结果呈现：各维度的 MAE/RMSE/R²/SMAPE 分布箱线图与柱状图
- 结论摘要：表现最差/最佳的切片与可能原因

## 10. 误差诊断与异常案例

- 高误差样本Top-N列表：样本ID、时间、特征摘要、预测/真实、误差、可能原因
- 模型盲区：系统性偏差（欠/过预测）
- 稳健性：对缺失、小样本、分布改变的敏感度
- 置信区间：覆盖率是否达标、误差是否对称

## 11. 超参搜索与模型比较

- 搜索轨迹：目标函数值随迭代（hpo_history.png）
- 最佳配置：参数表
- 候选模型对比表：指标、复杂度、推理耗时、资源占用

## 12. 性能与可运维性

- 训练耗时、峰值内存、设备占用
- 推理吞吐（样本/秒）、P50/P95延迟、批处理 vs 单样本
- 在线部署要求与资源估算

## 13. 结论与改进建议

- 结论：是否达到业务指标，在哪些场景仍需优化
- 建议：
  - 数据层：补充特征、提高采样质量、异常标注
  - 模型层：特征选择/正则/集成/时序结构/不确定性建模
  - 工程层：缓存/批处理/并行/蒸馏/量化
  - 监控层：上线后漂移检测、告警策略、定期重训

## 14. 复现实验

- 代码入口：scripts/generate_fitting_report.py（建议后续添加）
- 输入：数据路径、模型路径、配置
- 输出：reports/\<run_id> 下的图与本报告
- 命令示例：
  - python scripts/generate_fitting_report.py --config configs/exp.yaml --run-id 2025-08-14

## 15. 附录：指标公式（回归）

- MAE = mean(|y−ŷ|)
- RMSE = sqrt(mean((y−ŷ)^2))
- R² = 1 − SS_res/SS_tot
- MAPE = mean(|(y−ŷ)/y|) × 100%
- SMAPE = mean(2|y−ŷ|/(|y|+|ŷ|)) × 100%

## 16. 附录（泵学公式与曲线族）

- 相似定律：
  - Q ∝ n × D³（几何相似、阻力忽略）
  - H ∝ n² × D²
  - P ∝ n³ × D⁵
- 频率修正：若频率f变更，转速n≈k×f，按相似定律修正H-Q-P
- 系统阻力曲线：H_sys = a × Q² + b × Q + c（a、b、c由管网参数与阀位拟合）
- 泵/泵组并联：Q_total = Σ Q_i(H)；串联：H_total = Σ H_i(Q)
- 效率计算：η = ρ g Q H / (1000 P)
- NPSH：NPSH_a = (p_suction/ρg) − (p_vapor/ρg) + z − h_f
- H-Q多项式拟合：H(Q) ≈ α + βQ + γQ²（2~3阶多项式或物理先验约束拟合）
- 运行高效区：η ≥ η_max×τ（如τ=0.9），用于高效区着色与策略决策

______________________________________________________________________

使用说明：

- 本文档为标准化模板。每次实验请复制并替换“元信息”“指标表”“图表文件名”等内容；
- 建议配套生成脚本，自动产出图与汇总表，避免手工出错；
- 若需我帮你基于当前数据与模型自动生成报告与图表，请告知数据/模型路径与希望的 run_id。
