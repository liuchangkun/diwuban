<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>泵站优化系统 - 高级分析控制台</title>

    <!-- 外部依赖 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@4.17.21/lodash.min.js"></script>

    <!-- 共享资源 -->
    <link rel="stylesheet" href="../共享资源/common-styles.css">
    <script src="../共享资源/common-utils.js"></script>

    <!-- 页面特定样式 -->
    <link rel="stylesheet" href="./pump-dashboard-styles.css">

    <!-- 页面特定脚本 -->
    <script src="./js/pump-system.js"></script>
    <script src="./js/pump-dashboard-core.js"></script>
    <script src="./js/pump-dashboard-charts.js"></script>
    <script src="./js/pump-dashboard-realtime.js"></script>
    <script src="./js/pump-dashboard-analytics.js"></script>
    <script src="./js/pump-dashboard-optimization.js"></script>
    <script src="./js/pump-dashboard-diagnostics.js"></script>
</head>

<body>
    <div class="container">
        <!-- 页面头部 -->
        <div class="header">
            <h1>
                🚰 泵站优化系统 - 高级分析控制台
                <span class="status-badge status-online">● 在线</span>
                <span class="status-badge status-optimizing">⚡ 优化中</span>
            </h1>
            <div class="subtitle">
                <span>实时监控</span>
                <span>●</span>
                <span>智能分析</span>
                <span>●</span>
                <span>数据追溯</span>
                <span>●</span>
                <span>过程可视化</span>
                <span>●</span>
                <span id="lastUpdateTime">最后更新: 加载中...</span>
            </div>
        </div>

        <!-- 高级分析控制面板 -->
        <div class="panel analysis-control-panel">
            <div class="panel-title">
                🧠 智能分析控制台
                <div class="panel-actions">
                    <button class="btn btn-success" onclick="PumpDashboard.exportData('excel')">📊 Excel</button>
                    <button class="btn btn-warning" onclick="PumpDashboard.exportData('pdf')">📝 PDF</button>
                    <button class="btn btn-primary" onclick="PumpDashboard.exportData('json')">📦 JSON</button>
                    <button class="btn btn-info" onclick="PumpDashboard.switchView('dashboard')">📋 仪表盘</button>
                    <button class="btn btn-info" onclick="PumpDashboard.switchView('analysis')">🔍 分析视图</button>
                    <button class="btn btn-info" onclick="PumpDashboard.switchView('comparison')">🔄 对比视图</button>
                </div>
            </div>

            <div class="control-sections">
                <!-- 分析模式选择 -->
                <div class="control-section">
                    <div class="section-label">📊 分析模式</div>
                    <div class="mode-options">
                        <span class="option-tag active" data-mode="realtime">🔴 实时</span>
                        <span class="option-tag" data-mode="historical">📈 历史</span>
                        <span class="option-tag" data-mode="predictive">🔮 预测</span>
                        <span class="option-tag" data-mode="tracing">🔍 追溯</span>
                        <span class="option-tag" data-mode="diagnostic">🏥 诊断</span>
                        <span class="option-tag" data-mode="optimization">⚙️ 优化</span>
                    </div>
                </div>

                <!-- 时间范围控制 -->
                <div class="control-section">
                    <div class="section-label">⏰ 时间范围</div>
                    <div class="time-controls">
                        <span class="option-tag active" data-range="1h">1小时</span>
                        <span class="option-tag" data-range="6h">6小时</span>
                        <span class="option-tag" data-range="24h">24小时</span>
                        <span class="option-tag" data-range="7d">7天</span>
                        <span class="option-tag" data-range="30d">30天</span>
                        <span class="option-tag" data-range="1y">1年</span>
                        <input type="datetime-local" id="customTimeStart" placeholder="开始时间">
                        <input type="datetime-local" id="customTimeEnd" placeholder="结束时间">
                    </div>
                </div>

                <!-- 设备筛选 -->
                <div class="control-section">
                    <div class="section-label">🎯 设备筛选</div>
                    <div class="filter-options">
                        <span class="option-tag active" data-filter="all">全部</span>
                        <span class="option-tag" data-filter="online">在线</span>
                        <span class="option-tag" data-filter="warning">警告</span>
                        <span class="option-tag" data-filter="optimizing">优化中</span>
                        <span class="option-tag" data-filter="offline">离线</span>
                        <span class="option-tag" data-filter="maintenance">维护中</span>
                    </div>
                </div>

                <!-- 高级功能 -->
                <div class="control-section">
                    <div class="section-label">🔍 高级功能</div>
                    <div class="advanced-options">
                        <span class="option-tag" data-feature="anomaly">异常检测</span>
                        <span class="option-tag" data-feature="correlation">相关分析</span>
                        <span class="option-tag" data-feature="optimization">智能优化</span>
                        <span class="option-tag" data-feature="prediction">性能预测</span>
                        <span class="option-tag" data-feature="diagnostic">智能诊断</span>
                        <span class="option-tag" data-feature="maintenance">维护建议</span>
                        <span class="option-tag" data-feature="cost">成本分析</span>
                        <span class="option-tag" data-feature="carbon">碳排分析</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- 数据质量指标面板 -->
        <div class="panel quality-overview-panel">
            <div class="panel-title">📊 系统质量概览</div>
            <div class="quality-metrics grid grid-auto">
                <div class="stat-card quality-excellent">
                    <div class="stat-value" id="dataIntegrity">96.8%</div>
                    <div class="stat-label">数据完整性</div>
                    <div class="stat-trend trend-up">↗ +2.1%</div>
                </div>
                <div class="stat-card quality-good">
                    <div class="stat-value" id="realTimeAccuracy">89.2%</div>
                    <div class="stat-label">实时精度</div>
                    <div class="stat-trend trend-up">↗ +1.5%</div>
                </div>
                <div class="stat-card quality-warning">
                    <div class="stat-value" id="completionConfidence">73.5%</div>
                    <div class="stat-label">补齐置信度</div>
                    <div class="stat-trend trend-stable">→ 稳定</div>
                </div>
                <div class="stat-card quality-excellent">
                    <div class="stat-value" id="curveFittingR2">0.85</div>
                    <div class="stat-label">曲线拟合R²</div>
                    <div class="stat-trend trend-up">↗ +0.08</div>
                </div>
                <div class="stat-card quality-good">
                    <div class="stat-value" id="energySaving">12.3%</div>
                    <div class="stat-label">节能提升</div>
                    <div class="stat-trend trend-up">↗ +3.2%</div>
                </div>
                <div class="stat-card quality-excellent">
                    <div class="stat-value" id="systemAvailability">99.1%</div>
                    <div class="stat-label">系统可用性</div>
                    <div class="stat-trend trend-stable">→ 稳定</div>
                </div>
                <!-- 新增指标 -->
                <div class="stat-card quality-warning">
                    <div class="stat-value" id="dataFreshness">92.5%</div>
                    <div class="stat-label">数据新鲜度</div>
                    <div class="stat-trend trend-up">↗ +1.8%</div>
                </div>
                <div class="stat-card quality-excellent">
                    <div class="stat-value" id="predictionAccuracy">94.2%</div>
                    <div class="stat-label">预测准确率</div>
                    <div class="stat-trend trend-up">↗ +2.5%</div>
                </div>
                <div class="stat-card quality-good">
                    <div class="stat-value" id="anomalyDetection">87.6%</div>
                    <div class="stat-label">异常检测率</div>
                    <div class="stat-trend trend-stable">→ 稳定</div>
                </div>
            </div>
        </div>

        <!-- 运行状态总览 -->
        <div class="panel status-overview-panel">
            <div class="panel-title">⚡ 运行状态总览</div>
            <div class="status-metrics grid grid-auto">
                <div class="stat-card">
                    <div class="stat-value accuracy-excellent" id="totalEfficiency">85.6%</div>
                    <div class="stat-label">泵组总效率</div>
                    <div class="stat-trend trend-up">↗ +2.3%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value accuracy-good" id="totalFlow">1,247</div>
                    <div class="stat-label">总流量 (m³/h)</div>
                    <div class="stat-trend trend-stable">→ 稳定</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value accuracy-average" id="totalPower">342.8</div>
                    <div class="stat-label">总功耗 (kW)</div>
                    <div class="stat-trend trend-down">↘ -5.1%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value accuracy-good" id="activePumps">6/8</div>
                    <div class="stat-label">运行泵数</div>
                    <div class="stat-trend trend-stable">→ 最优</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value accuracy-poor" id="alertCount">2</div>
                    <div class="stat-label">异常报警</div>
                    <div class="stat-trend trend-warning">⚠ 需关注</div>
                </div>
                <!-- 新增指标 -->
                <div class="stat-card">
                    <div class="stat-value accuracy-excellent" id="vibrationLevel">2.1</div>
                    <div class="stat-label">振动水平 (mm/s)</div>
                    <div class="stat-trend trend-stable">→ 正常</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value accuracy-good" id="temperatureStatus">72.5°C</div>
                    <div class="stat-label">平均温度</div>
                    <div class="stat-trend trend-up">↗ +1.2°C</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value accuracy-good" id="sealCondition">94.3%</div>
                    <div class="stat-label">密封状态</div>
                    <div class="stat-trend trend-up">↗ +0.8%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value accuracy-warning" id="bearingWear">12.7%</div>
                    <div class="stat-label">轴承磨损</div>
                    <div class="stat-trend trend-up">↗ +0.3%</div>
                </div>
            </div>
        </div>

        <!-- 主要内容区域 -->
        <div class="main-content grid grid-2">
            <!-- 实时数据流监控 -->
            <div class="panel realtime-monitor-panel">
                <div class="panel-title">
                    📡 实时数据流监控
                    <div class="panel-actions">
                        <button class="btn btn-sm btn-warning" onclick="PumpDashboard.toggleRealTime()">
                            <span id="realTimeToggle">⏸ 暂停</span>
                        </button>
                        <button class="btn btn-sm btn-secondary" onclick="PumpDashboard.exportLogs()">📥 导出日志</button>
                        <button class="btn btn-sm btn-primary" onclick="PumpDashboard.clearStream()">🗑️ 清空</button>
                    </div>
                </div>

                <div class="filter-tabs">
                    <span class="tab-button active" data-type="all">🔍 全部事件</span>
                    <span class="tab-button" data-type="optimization">⚡ 优化事件</span>
                    <span class="tab-button" data-type="alerts">🚨 异常报警</span>
                    <span class="tab-button" data-type="performance">📈 性能指标</span>
                    <span class="tab-button" data-type="diagnostic">🏥 诊断事件</span>
                    <span class="tab-button" data-type="maintenance">🔧 维护提醒</span>
                </div>

                <div class="real-time-stream" id="realTimeStream">
                    <!-- 实时数据流将在这里动态显示 -->
                </div>
            </div>

            <!-- 设备健康状态 -->
            <div class="panel device-health-panel">
                <div class="panel-title">
                    🏥 设备健康监控
                    <div class="panel-actions">
                        <button class="btn btn-sm btn-primary" onclick="PumpDashboard.refreshDevices()">🔄 刷新</button>
                        <button class="btn btn-sm btn-primary" onclick="PumpDashboard.showDeviceDetails()">🔍
                            详情</button>
                        <button class="btn btn-sm btn-success" onclick="PumpDashboard.generateHealthReport()">📊
                            报告</button>
                    </div>
                </div>

                <div class="device-health-summary">
                    <div class="health-stats grid grid-4">
                        <div class="health-stat excellent">
                            <div class="health-count" id="healthyDevices">6</div>
                            <div class="health-label">健康设备</div>
                        </div>
                        <div class="health-stat warning">
                            <div class="health-count" id="warningDevices">2</div>
                            <div class="health-label">警告设备</div>
                        </div>
                        <div class="health-stat critical">
                            <div class="health-count" id="criticalDevices">0</div>
                            <div class="health-label">严重设备</div>
                        </div>
                        <div class="health-stat maintenance">
                            <div class="health-count" id="maintenanceDevices">1</div>
                            <div class="health-label">维护中</div>
                        </div>
                    </div>

                    <!-- 健康趋势图 -->
                    <div class="chart-container small">
                        <canvas id="healthTrendChart"></canvas>
                    </div>
                </div>

                <div class="device-list" id="deviceList">
                    <!-- 设备列表将在这里动态显示 -->
                </div>
            </div>
        </div>

        <!-- 性能分析面板 -->
        <div class="main-content grid grid-2">
            <!-- 泵站运行分析 -->
            <div class="panel station-analysis-panel">
                <div class="panel-title">🏭 泵站运行分析</div>

                <div class="station-tabs">
                    <button class="tab-button active" onclick="PumpDashboard.switchStation('A')">泵站A</button>
                    <button class="tab-button" onclick="PumpDashboard.switchStation('B')">泵站B</button>
                    <button class="tab-button" onclick="PumpDashboard.switchStation('C')">泵站C</button>
                    <button class="tab-button" onclick="PumpDashboard.switchStation('all')">全部</button>
                </div>

                <div class="station-overview">
                    <div class="chart-container">
                        <canvas id="stationPerformanceChart"></canvas>
                    </div>
                    <div class="station-metrics" id="stationMetrics">
                        <!-- 泵站指标将在这里显示 -->
                    </div>
                </div>
            </div>

            <!-- 能耗分析 -->
            <div class="panel energy-analysis-panel">
                <div class="panel-title">⚡ 能耗优化分析</div>

                <div class="energy-summary grid grid-2">
                    <div class="energy-card">
                        <div class="energy-label">当前功耗</div>
                        <div class="energy-value" id="currentPower">342.8 kW</div>
                        <div class="energy-trend trend-down">↘ -5.1%</div>
                    </div>
                    <div class="energy-card">
                        <div class="energy-label">节能效果</div>
                        <div class="energy-value" id="energySavings">18.2 kW</div>
                        <div class="energy-trend trend-up">↗ +12.3%</div>
                    </div>
                    <!-- 新增能耗指标 -->
                    <div class="energy-card">
                        <div class="energy-label">单位能耗</div>
                        <div class="energy-value" id="unitEnergy">0.275 kWh/m³</div>
                        <div class="energy-trend trend-down">↘ -3.2%</div>
                    </div>
                    <div class="energy-card">
                        <div class="energy-label">碳排放</div>
                        <div class="energy-value" id="carbonEmission">0.185 tCO₂</div>
                        <div class="energy-trend trend-down">↘ -4.1%</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="energyTrendChart"></canvas>
                </div>

                <div class="optimization-suggestions" id="optimizationSuggestions">
                    <!-- 优化建议将在这里显示 -->
                </div>
            </div>
        </div>

        <!-- 新增：工艺过程分析面板 -->
        <div class="panel process-analysis-panel">
            <div class="panel-title">🔧 工艺过程分析</div>

            <div class="process-tabs">
                <button class="tab-button active"
                    onclick="PumpDashboard.switchProcessTab('characteristic')">特性曲线</button>
                <button class="tab-button" onclick="PumpDashboard.switchProcessTab('coordination')">泵组协调</button>
                <button class="tab-button" onclick="PumpDashboard.switchProcessTab('frequency')">变频调速</button>
                <button class="tab-button" onclick="PumpDashboard.switchProcessTab('network')">管网特性</button>
            </div>

            <div class="process-content">
                <div class="chart-container">
                    <canvas id="processAnalysisChart"></canvas>
                </div>
                <div class="process-metrics" id="processMetrics">
                    <!-- 工艺指标将在这里显示 -->
                </div>
            </div>
        </div>

        <!-- 新增：经济性分析面板 -->
        <div class="panel economic-analysis-panel">
            <div class="panel-title">💰 经济性分析</div>

            <div class="economic-tabs">
                <button class="tab-button active" onclick="PumpDashboard.switchEconomicTab('cost')">运营成本</button>
                <button class="tab-button" onclick="PumpDashboard.switchEconomicTab('maintenance')">维护成本</button>
                <button class="tab-button" onclick="PumpDashboard.switchEconomicTab('lifecycle')">生命周期</button>
                <button class="tab-button" onclick="PumpDashboard.switchEconomicTab('roi')">投资回报</button>
            </div>

            <div class="economic-content">
                <div class="economic-summary grid grid-4">
                    <div class="economic-card">
                        <div class="economic-label">日运营成本</div>
                        <div class="economic-value" id="dailyCost">¥2,847</div>
                        <div class="economic-trend trend-down">↘ -8.3%</div>
                    </div>
                    <div class="economic-card">
                        <div class="economic-label">月维护费</div>
                        <div class="economic-value" id="monthlyMaintenance">¥15,200</div>
                        <div class="economic-trend trend-stable">→ 稳定</div>
                    </div>
                    <div class="economic-card">
                        <div class="economic-label">年节省</div>
                        <div class="economic-value" id="annualSavings">¥342,000</div>
                        <div class="economic-trend trend-up">↗ +12.5%</div>
                    </div>
                    <div class="economic-card">
                        <div class="economic-label">ROI</div>
                        <div class="economic-value" id="roiValue">18.6%</div>
                        <div class="economic-trend trend-up">↗ +2.1%</div>
                    </div>
                </div>

                <div class="chart-container">
                    <canvas id="economicAnalysisChart"></canvas>
                </div>
            </div>
        </div>

        <!-- 新增：智能诊断面板 -->
        <div class="panel diagnostic-panel">
            <div class="panel-title">
                🏥 智能诊断系统
                <div class="panel-actions">
                    <button class="btn btn-sm btn-primary" onclick="PumpDashboard.runDiagnostics()">🔍 运行诊断</button>
                    <button class="btn btn-sm btn-success" onclick="PumpDashboard.generateDiagnosticReport()">📊
                        诊断报告</button>
                </div>
            </div>

            <div class="diagnostic-content">
                <div class="diagnostic-summary grid grid-3">
                    <div class="diagnostic-card">
                        <div class="diagnostic-label">健康评分</div>
                        <div class="diagnostic-value" id="healthScore">87.6</div>
                        <div class="diagnostic-status good">良好</div>
                    </div>
                    <div class="diagnostic-card">
                        <div class="diagnostic-label">风险指数</div>
                        <div class="diagnostic-value" id="riskIndex">12.4</div>
                        <div class="diagnostic-status low">低风险</div>
                    </div>
                    <div class="diagnostic-card">
                        <div class="diagnostic-label">预测准确率</div>
                        <div class="diagnostic-value" id="diagnosticAccuracy">94.2%</div>
                        <div class="diagnostic-status excellent">优秀</div>
                    </div>
                </div>

                <div class="diagnostic-details">
                    <div class="chart-container small">
                        <canvas id="diagnosticRadarChart"></canvas>
                    </div>
                    <div class="diagnostic-findings" id="diagnosticFindings">
                        <!-- 诊断发现将在这里显示 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 深度分析和追溯面板 -->
        <div class="panel traceability-panel">
            <div class="panel-title">
                🔍 数据追溯和深度分析
                <div class="panel-actions">
                    <button class="btn btn-sm btn-primary" onclick="PumpDashboard.showAdvancedSearch()">🔍 高级搜索</button>
                    <button class="btn btn-sm btn-success" onclick="PumpDashboard.generateAnalysisReport()">📊
                        生成报告</button>
                    <button class="btn btn-sm btn-info" onclick="PumpDashboard.showComparison()">🔄 对比分析</button>
                </div>
            </div>

            <div class="traceability-controls">
                <div class="control-group">
                    <label>追溯类型:</label>
                    <select id="traceType">
                        <option value="performance">性能追溯</option>
                        <option value="optimization">优化过程</option>
                        <option value="anomaly">异常分析</option>
                        <option value="calibration">校准历史</option>
                        <option value="maintenance">维护记录</option>
                        <option value="diagnostic">诊断历史</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>时间范围:</label>
                    <select id="traceTimeRange">
                        <option value="1h">最近1小时</option>
                        <option value="6h">最近6小时</option>
                        <option value="24h">最近24小时</option>
                        <option value="7d">最近7天</option>
                        <option value="30d">最近30天</option>
                        <option value="1y">最近1年</option>
                        <option value="custom">自定义</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>设备范围:</label>
                    <select id="traceDevices" multiple>
                        <option value="all" selected>全部设备</option>
                        <option value="station_a">泵站A</option>
                        <option value="station_b">泵站B</option>
                        <option value="station_c">泵站C</option>
                    </select>
                </div>
            </div>

            <div class="traceability-results">
                <div class="trace-timeline" id="traceTimeline">
                    <!-- 追溯时间线将在这里显示 -->
                </div>
                <div class="trace-details" id="traceDetails">
                    <!-- 详细信息将在这里显示 -->
                </div>
            </div>
        </div>

        <!-- 系统日志面板 -->
        <div class="panel log-panel">
            <div class="panel-title">
                📜 系统日志监控
                <div class="panel-actions">
                    <select id="logLevelFilter">
                        <option value="all">全部日志</option>
                        <option value="info">信息</option>
                        <option value="warn">警告</option>
                        <option value="error">错误</option>
                        <option value="success">成功</option>
                        <option value="debug">调试</option>
                    </select>
                    <button class="btn btn-sm btn-primary" onclick="PumpDashboard.clearLogs()">🗑️ 清空</button>
                    <button class="btn btn-sm btn-success" onclick="PumpDashboard.exportLogs()">📥 导出</button>
                    <button class="btn btn-sm btn-info" onclick="PumpDashboard.showLogAnalysis()">📊 分析</button>
                </div>
            </div>

            <div class="log-viewer" id="logViewer">
                <!-- 日志内容将在这里显示 -->
            </div>
        </div>
    </div>

    <!-- 加载指示器 -->
    <div id="loadingIndicator" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text">数据加载中...</div>
    </div>

    <!-- 初始化脚本 -->
    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 检查所有模块是否已加载
            if (window.PumpSystem && window.PumpDashboard) {
                // 启动泵站仪表盘
                PumpSystem.PageManager.init(() => {
                    PumpDashboard.init();
                });
            } else {
                console.error('模块加载失败，请检查脚本引用');
            }
        });
    </script>
</body>

</html>