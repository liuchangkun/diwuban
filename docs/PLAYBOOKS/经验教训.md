# 经验教训（LESSONS_LEARNED）

目的：记录问题根因、教训与防重复机制。

## 模板

______________________________________________________________________

## id: LES-YYYYMMDD-001 date: YYYY-MM-DD scope: \<范围> summary: \<一句话总结>

- 事件：
- 根因：
- 教训：
- 行动：

## 记录

______________________________________________________________________

## id: LES-20250816-001 date: 2025-08-16 scope: db-docs summary: PowerShell 单行 psql 命令易受引号/变量影响，建议改用 \\i 方式执行脚本

- 事件：索引/列导出时多次因引号转义失败
- 根因：Windows PowerShell 的引号转义规则复杂易错
- 教训：避免在 CI/命令行中使用复杂引号；优先使用脚本文件并 \\i 执行
- 行动：编写 doc_extract_columns.sql 等脚本，统一执行方式

______________________________________________________________________

## id: LES-20250817-002 date: 2025-08-17 scope: tooling summary: 避免 mdformat 与自定义脚本（memory_index）互相改写导致循环

- 事件：pre-commit 中 mdformat 与 memory_index 交替修改导航与索引，导致始终不绿
- 根因：两者对下划线/表头分隔线/空白的处理规则不一致；脚本未做语义级比较
- 教训：对与格式化工具交互的生成脚本，需要做“语义级幂等比较”，避免反复写入
- 行动：
  - memory_index：增加表头兼容、转义对齐与语义比较；写入时固定换行
  - PR 流程：出现循环时优先让生成脚本“向格式化器妥协”，以 mdformat 输出为准
