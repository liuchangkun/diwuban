# 特性曲线拟合技术规范

## 概述

特性曲线拟合是水泵性能分析的核心技术，通过将现场数据与水泵机理深度结合，实现高精度、高可靠性的曲线建模。

## 核心原理

### 相似定律约束

- **流量相似**：Q₁/Q₂ = (n₁/n₂)(D₁/D₂)³
- **扬程相似**：H₁/H₂ = (n₁/n₂)²(D₁/D₂)²
- **功率相似**：P₁/P₂ = (ρ₁/ρ₂)(n₁/n₂)³(D₁/D₂)⁵

### 形状约束

- **扬程特性**：H(Q) 单调递减，dH/dQ ≤ 0
- **效率特性**：η(Q) 单峰函数，存在最佳效率点
- **功率特性**：P(Q) 单调递增（大多数离心泵）

### 物理约束

- **欧拉方程**：H_th = (u₂c₂ᵤ - u₁c₁ᵤ)/g
- **能量平衡**：P_hydraulic = ρgQH/η
- **效率范围**：0 \< η ≤ 1

## 拟合策略序列

### 优先级策略

1. **物理信息神经网络**（PINN）- 最高精度
1. **约束多项式拟合** - 平衡精度与稳定性
1. **相似定律增强拟合** - 多工况适应
1. **传统机器学习方法** - 通用性强
1. **线性回归** - 兜底方案

### 自动降级机制

- 当高级方法失败或不满足物理约束时，自动降级到下一级方法
- 每个方法都有对应的质量阈值要求
- 确保始终能获得物理合理的拟合结果

## 质量验证体系

### 数学精度验证

- R² ≥ 0.85（优秀）
- RMSE ≤ 5%（相对误差）
- MAE ≤ 3%（平均绝对误差）

### 物理合理性验证

- 相似定律遵循度 ≥ 85%
- 形状约束违反率 ≤ 15%
- 能量平衡误差 ≤ 10%

### 工程应用验证

- 与制造商曲线对比
- 历史运行数据验证
- 专家经验审核

## 现场数据约束

基于 `docs/程序工作流程.md` 和现场数据驱动原则：

### 单位统一

- 压力：统一使用 MPa
- 流量：m³/h
- 扬程：H ≈ (Δp_MPa×1e6)/(ρ·g) + b_H
- 效率：η = (ρ·g·Q_s·H)/(P_in×1000)

### 稳态筛选

- 流量变化率：|dQ/dt| \< 5 m³/h/min
- 扬程变化率：|dH/dt| \< 1 m/min
- 频率稳定性：频率标准差 \< 0.5 Hz

## 实施要点

### 代码实现

- 位于：`app/services/curve_fitting.py`
- 依赖：numpy, scipy, sklearn
- 备用算法：确保在库不可用时的降级实现

### 数据库集成

- 曲线存储：`curves` 表
- 版本管理：支持曲线历史版本
- 元数据：拟合方法、精度指标、有效期

### API接口

- 拟合请求：POST /api/v1/curves/fit
- 结果查询：GET /api/v1/curves/{id}
- 质量评估：GET /api/v1/curves/{id}/quality

## 性能目标

基于物理约束拟合的预期效果：

- 扬程RMSE：≤ 2.0m（相比传统方法提升60%+）
- 效率MAE：≤ 3%（相比传统方法提升60%+）
- 流量误差：≤ 5%（相比传统方法提升65%+）
- 整体精度：提升60%以上

## 参考文档

- 详细实现：`实施过程/分解文档/14_水泵机理与拟合算法结合技术实现指南.md`
- 深度融合：`实施过程/分解文档/09_水泵机理与拟合算法融合.md`
- 曲线体系：`实施过程/分解文档/07_泵组特性曲线体系定义.md`
