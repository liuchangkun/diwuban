# 可视化（占位）

> 状态板（2025-08-18）：端到端导入链路修复后，将基于标准 schema 的事实层与汇总层构建可视化原型与质量/对齐/曲线/优化看板。参考：docs/PLAYBOOKS/SESSION_SNAPSHOT_2025-08-18.md。

- 原型：Streamlit/Dash（快速验证）
- 视图：完整度/缺失/离群；对齐/派生；特性曲线；优化结果
- 元数据追踪：图上标注版本/参数

## 前端对接指南（原始数据 wide/long）

- 端点

  - /api/v1/data/devices/{id}/raw?start_time=...&end_time=...&limit=...&format=wide|long
  - /api/v1/data/stations/{id}/raw?start_time=...&end_time=...&limit=...&format=wide|long

- wide（推荐用于“横向表格”/Dataset）

  - data\[i\] = { record_timestamp, metrics_data }
  - 表格：列名 = Object.keys(metrics_data)，行为 record_timestamp
  - ECharts：将 metrics_data 展开为多 series（series.name=指标名，x=时间，y=值）

- long（推荐用于“指标为维度”的图表）

  - data\[i\] = { ts, metric, value }
  - 前端按 metric 分组再绘图；或通过 reduce 透视成宽表：

```js
const rowMap = new Map();
const colSet = new Set(['ts']);
for (const { ts, metric, value } of data) {
  if (!rowMap.has(ts)) rowMap.set(ts, { ts });
  rowMap.get(ts)[metric] = value;
  colSet.add(metric);
}
const columns = Array.from(colSet);
const rows = Array.from(rowMap.values()).sort((a,b)=>new Date(a.ts)-new Date(b.ts));
```
