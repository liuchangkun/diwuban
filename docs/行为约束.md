# 行为约束（骨架）

> 说明：以安全、审计、回滚为核心，所有约束均与现有代码/配置对应。

## 1. 安全与合规
- 禁止在代码与日志中出现敏感信息（账号、密码、DSN、令牌）
- 配置仅允许 YAML（configs/），严禁在代码中拼接 DSN
- 日志脱敏：见 docs/日志规范.md、docs/日志运维.md

## 2. 变更与回滚
- 小批量变更；每批提供映射清单与验证步骤
- 变更失败立即按映射清单回滚
- 任何“删除”动作需进入观察期后执行

## 3. 性能与资源
- 数据库：严格遵循 settings.db.timeouts 与 retry；禁止大事务
- 背压控制：p95/失败率阈值触发降并发与缩批

## 4. 文档一致性
- 功能改动同步更新 docs/；不一致项记录于 docs/reports/文档对照差异报告.md
- 新增 API/配置/表结构，必须更新映射清单

## 5. MCP 使用约束
- 任何可能影响现有文件的操作前，必须“确认执行”
- 通过任务清单（add_tasks/update_tasks）跟踪每个子任务
- 文档落地使用 str-replace-editor；严禁直接覆盖已有文件

## 6. 审计与记录
- 在 docs/reports/ 持续沉淀执行清单、失败与回滚报告
- 关键动作（迁移/统一路径/DDL 变更）前后生成快照

