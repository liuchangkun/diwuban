# 严格模式-核对清单（Strict Mode Checklist）

用途

- 作为开发/评审/合并前的自查表，与 PR 模板勾选项一致

一、事前核对

- [ ] 变更说明完整：Why/What/Impact/Risk/Rollback + 受影响对象清单
- [ ] 已查阅并对齐：PROJECT_RULES.md、docs/智能助手行为控制.md、docs/文档地图与导航.md
- [ ] 涉及数据库/导入/合并时：核对 SCHEMA_AND_DB.md、DATA_SPEC.md、ALIGNMENT_POLICY.md、PERFORMANCE_OPTIMIZATION.md、crud_optimization_functions.sql
- [ ] 检索 PLAYBOOKS 历史（决策/错误与修复/配置变更/经验教训）以避免既知坑

二、过程控制

- [ ] 使用任务清单管理（MCP）：调查→实施→验证→文档同步→PLAYBOOKS 记录
- [ ] 变更最小化：多文件改动先确认边界，分步提交并逐步验证
- [ ] 保守修改：先确认函数/类签名与依赖；跨层改动先做小步 E2E
- [ ] 受限操作遵守：不操作 data/ 与 venv/；不直接改包清单；依赖变更需授权并使用包管理器
- [ ] 配置来源：数据库/日志仅 YAML（configs/database.yaml、configs/logging.yaml）；严禁 ENV/CLI/代码覆盖；严禁拼接 DSN

三、验证标准

- [ ] 低成本验证（MCP）：优先跑单测/静态检查/最小 CLI 演练（附命令、cwd、exit code、关键日志）
- [ ] 成功定义达成：退出码 0；无明显报错日志；env.json 含 args_summary/config_snapshot/sources/ts/run_id/run_dir
- [ ] 失败处理：≤2 次小步修复并重试；超出即停并人工确认

四、事后同步

- [ ] 文档同步：指南/规则/地图/功能文档已更新并可导航到
- [ ] PLAYBOOKS 更新：记录变更、原因、影响、经验教训
- [ ] 关键记忆已保存，确保后续会话自动遵循规范

五、安全与合规

- [ ] 未触碰 data/ 与 venv/；未执行高风险未授权操作
- [ ] 数据库/日志配置未出现在代码/ENV/CLI；仅 YAML 来源；无 DSN 拼接
- [ ] 如有高风险操作：已获得授权口令并在 PR 中粘贴

六、MCP 默认工具确认

- [ ] Context 7（库/框架文档检索）已用于方案与API核对（或说明豁免原因）

- [ ] Sequential thinking（任务分解/反思）已用于本次改动的任务管理与验证（或说明豁免原因）

- [ ] sources 快照核对：env.json 中 db/logging 来源仅为 YAML/DEFAULT（无 ENV/CLI）

- [ ] 若豁免：已提供替代验证证据与风险评估，并在 PR 模板“豁免说明”中记录
